(function(){"use strict";const{abs:L,cos:W,sin:b,cosh:I,sinh:K,acos:P,acosh:A,tan:D,min:F,max:G,round:H,sqrt:J,sign:N,floor:Q,log:U,exp:g,PI:V}=Math,y=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?-1:1},M=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?1:-1},k=(e,n)=>{const t=new Map,o=Object.keys(e).sort(n);for(let s=0;s<o.length;s++){const i=o[s],[c,r]=[i,e[i]].sort(n);t.has(r)?t.set(r,[c,t.get(r)].sort()[0]):t.set(r,c)}return t},a=(e,n)=>{if(n.length===0||e.size===0)return n;const t=e._re_cache||new RegExp([...e.keys()].join("|"),"g");let o=n;do n=o,o=n.replace(t,s=>e.get(s));while(o!==n);return n},R=(e,n)=>{const t=new Map(e);for(e=[...e.entries()];e.length>0;){x();const[o,s]=e.pop();t.delete(o);const i=a(t,o),c=a(t,s);let r=!0;if(i===c)r=!1;else{const[l,f]=[i,c].sort(n);f!==o&&l!==s&&(t.set(f,l),e.push([f,l]),r=!1)}r&&t.set(o,s)}return t},j=function(e,n){if(n.length===0)return null;const t=Math.max(0,e.length-n.length);for(let o=t;o<e.length;o++)if(e[o]===n[0]&&e.slice(o+1)===n.slice(1,e.length-o))return{prefix:e.slice(0,o),suffix:n.slice(e.length-o)}},B=function(e,n){if(n.length===0)return null;for(let t=0;t<e.length-n.length+1;t++)if(e.slice(t,t+n.length)===n)return{prefix:e.slice(0,t),suffix:e.slice(t+n.length)}},E=(e,n,t,o)=>{const s=j(e,t);if(s)return{s1:s.prefix+o,s2:n+s.suffix};const i=B(e,t);if(i)return{s1:n,s2:i.prefix+o+i.suffix}},_=(e,n)=>{const t=new Map(e),o=[...e.entries()];for(let s=0;s<o.length;s++){x();const[i,c]=o[s];for(let r=0;r<o.length;r++){if(s===r)continue;const[l,f]=o[r],u=E(i,c,l,f);if(u){const m=a(e,u.s1),v=a(e,u.s2);if(m!==v){const[q,C]=[m,v].sort(n);t.set(C,q)}}}}return t},d=(e,n)=>_(R(e,n),n),z=(e,n)=>{if(e.size!==n.size)return!1;const t=e.keys();for(;;){const{done:o,value:s}=t.next();if(o)return!0;if(e.get(s)!==n.get(s))return!1}},T=(e,n)=>{for(e=k(e,n);;){const t=d(e,n);if(z(t,e))return t._re_cache=new RegExp([...t.keys()].join("|"),"g"),t;e=t}};let p,w;const x=()=>{if(performance.now()-p>w)throw new Error("Timeout")},O=(e,n)=>{const t=[50,100,g(n)*4,g(n)*10].map(o=>[o,o]).flat();for(let o=0;o<t.length;o++){w=t[o];try{return p=performance.now(),T(e,o%2?y:M)}catch(s){if(s.message!=="Timeout")throw s}}throw new Error("Timeout")},h=e=>String.fromCharCode(97+e),S=(e,n)=>{const t={};for(let o=0;o<e;o++)t[h(o).repeat(2)]="";for(let o=1;o<e;o++)for(let s=0;s<o;s++)t[(h(s)+h(o)).repeat(n[o][s])]="";return t};onmessage=({data:{dimensions:e,coxeter:n,uuid:t}})=>{const o=S(e,n);try{const s=O(o,e);postMessage({rules:s,uuid:t})}catch(s){postMessage({rules:new Map(Object.entries(o)),warn:s.message||"Empty error",uuid:t})}}})();
