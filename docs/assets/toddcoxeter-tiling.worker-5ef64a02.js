(function(){"use strict";const c=n=>String.fromCharCode(97+n),j=(n,e)=>{const l=[];for(let s=0;s<n;s++)l.push(c(s).repeat(2));for(let s=1;s<n;s++)for(let t=0;t<s;t++)l.push((c(t)+c(s)).repeat(e[s][t]));return l},x=(n,e,l)=>{const s=j(n,e),t=[...Array(n).keys()].map(r=>c(r)).join(""),i=l.map((r,u)=>r?"":c(u)).join("");return{gens:t,subgens:i,rels:s}},M=(n,e,l)=>{const s=j(n,e),t=[...Array(n).keys()].map(r=>c(r)).join(""),i=[];for(let r=0;r<l.length;r++)if(l[r]){let u=c(r);for(let h=0;h<n;h++)e[r][h]===2&&(l[h]||(u+=c(h)));i.push({gens:t,subgens:u,rels:s,edgeMirror:c(r)})}return i},P=(n,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const l=n.normal[e.left_coset][e.rel[e.left]];if(l===void 0)break;e.left++,e.left_coset=l}for(;e.left!==e.right;){const l=n.reverse[e.right_target][e.rel[e.right]];if(l===void 0)break;e.right--,e.right_target=l}return e.left===e.right?(n.normal[e.left_coset][e.rel[e.right]]=e.right_target,n.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},C=n=>{const{gens:e,subgens:l,rels:s,cosets:t,rows:i,words:r,limit:u}=n,h=e.length,p=s.map(o=>[...o].map(g=>e.indexOf(g))),b=l.split("").map(o=>e.indexOf(o));if(t.normal.length===0){t.normal.push(new Array(h).fill()),t.reverse.push(new Array(h).fill());for(let o=0;o<b.length;o++)t.normal[0][b[o]]=0,t.reverse[0][b[o]]=0}for(i.length===0&&i.push(...p.map(o=>({rel:o,left:0,right:o.length-1,left_coset:0,right_target:0})));i.length&&t.normal.length<u;){for(;;){let f=!1;for(let a=i.length-1;a>=0;a--)P(t,i[a])&&(f=!0,i.splice(a,1));if(!f)break}const o=t.normal.length;let g=!1;for(let f=0;f<t.normal.length;f++){const a=t.normal[f];for(let _=0;_<a.length;_++){let d=a[_];if(d===void 0){d=t.normal.length,t.normal.push(new Array(h).fill()),t.reverse.push(new Array(h).fill()),t.normal[f][_]=d,t.reverse[d][_]=f,i.push(...p.map(y=>({rel:y,left:0,right:y.length-1,left_coset:o,right_target:o}))),g=!0;break}}if(g)break}}for(i.length||(n.done=!0),r.length===0&&(r[0]="");V(t.normal.length,r);)for(let o=0;o<r.length;o++){if(r[o]===void 0)continue;const g=t.normal[o];for(let f=0;f<g.length;f++){const a=g[f];r[a]===void 0&&(r[a]=r[o]+c(f))}}return{cosets:t,rows:i,words:r}},V=(n,e)=>{for(let l=0;l<n;l++)if(e[l]===void 0)return!0;return!1},v=(n,e,l)=>{let s=0;for(let t=0;t<n.length;t++)s+=n[t]*e[t]*(t===n.length-1&&l||1);return s},L=(n,e,l)=>{n=n.slice();const s=2*v(n,e,l);for(let t=0;t<n.length;t++)n[t]-=s*(l||t!==n.length-1?e[t]:0);return n};let m=null,A=null;const S=(n,e,l)=>{const s=()=>({cosets:{normal:[],reverse:[]},rows:[],words:[],done:!1});m={...x(n,e,l),...s()},A=M(n,e,l).map(t=>({...t,...s()}))},k=(n,e)=>{const{rootVertex:l,mirrorsPlanes:s,curvature:t}=n;let i=l;for(let r=0;r<e.length;r++)i=L(i,s[e.charCodeAt(r)-97],t);return i};onmessage=({data:{order:n,curvature:e,mirrorsPlanes:l,coxeter:s,mirrors:t,rootVertex:i,dimensions:r,uuid:u}})=>{n===0&&S(r,s,t);const h=(n+1)*(e>0?2500:250);try{let p=[],b=[];if(!m.done){let o=m.words.length;m.limit=h,C(m);for(let g=o;g<m.words.length;g++){const f=m.words[g],a=k({rootVertex:i,mirrorsPlanes:l,curvature:e},f);p.push({vertex:a,word:f})}}for(let o=0;o<A.length;o++){const g=A[o];if(g.done)continue;const f=g.words.length;g.limit=h,C(g);const a=i.slice(),_=k({rootVertex:a,mirrorsPlanes:l,curvature:e},g.edgeMirror);for(let d=f;d<g.words.length;d++){const y=g.words[d],E=k({rootVertex:a,mirrorsPlanes:l,curvature:e},y),O=k({rootVertex:_,mirrorsPlanes:l,curvature:e},y);b.push({start:E,end:O,word:y})}}postMessage({vertices:p,edges:b,uuid:u})}catch(p){postMessage({error:p.message,uuid:u})}}})();
