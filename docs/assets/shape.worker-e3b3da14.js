(function(){"use strict";const U=["vertex","edge","face"],T=(e,t=null,n=1,o=!1)=>{if(t===null&&(t=e,e=0),n===0)throw new Error("Step cannot be zero.");if(t<e&&n>0||t>e&&n<0){if(o)return[];n=-n}return new Array(Math.ceil((t-e)/n)).fill().map((f,c)=>e+c*n)},H=(e,t)=>e.length!==t.length?!1:e.every((n,o)=>Array.isArray(n)?H(n,t[o]):n===t[o]),re=e=>e!==""&&e!=="x",E=e=>e==="s"||e==="b",se=(e,t)=>{let n=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o];return n},ke=(e,t)=>{const n=[];for(let o=0;o<e.length;o++)n[o]=e[o]-t[o];return n},p=(e,t)=>{const n=[];for(let o=0;o<e.length;o++)n[o]=e[o]*t;return n},Ae=e=>{const t=[];for(let n=0;n<e[0].length;n++){t.push([]);for(let o=0;o<e.length;o++)t[n].push(e[o][n])}return t},m=(e,t)=>{const n=new Array(e.length);for(let o=0;o<e.length;o++){let f=0;for(let c=0;c<e[0].length;c++)f+=e[o][c]*t[c];n[o]=f}return n},Se=e=>{const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=new Array(e.length).fill(0),t[n][n]=e[n];return t},ie=e=>{const t=new Array(e).fill(1);return Se(t)},D=(e,t)=>e.filter((n,o)=>!t.includes(o)),K=(e,t)=>D(e,t).map(n=>D(n,t)),le=(e,t,n)=>ke(e,p(m(Ve(n),t),2*se(m(We(n),e),t))),Me=(e,t)=>t.some((n,o)=>n.some((f,c)=>o===c&&f===0))?p(e,1/e[e.length-1]):p(e,-1/Ce(ce(se(m(t,e),e)))),We=e=>e.map((t,n)=>t.map((o,f)=>n===f&&o===0?1:o)),Ve=e=>e.map(t=>t.map(n=>ce(n))),L=(e,t,n,o)=>{const f=G/e,c=G/t,a=G/n;return fe(G/qe(-_(f)*_(a)+R(f)*R(a)*((_(c)-_(o*f)*_(a))/(R(o*f)*R(a)))))},{abs:ce,cos:_,sin:R,tan:Re,cosh:Ge,sinh:Je,acos:qe,acosh:Qe,atan:Xe,atan2:Ye,min:Ze,max:$e,round:fe,sqrt:Ce,cbrt:pe,sign:me,ceil:Ie,floor:et,log:tt,exp:nt,hypot:ot,pow:Oe,PI:G}=Math,ue=new ArrayBuffer(8),Ne=new Float64Array(ue),ge=new Int32Array(ue);function Ee(e){return~~e===e?~~e:(Ne[0]=e,ge[0]^ge[1])}const de=10**4,I=e=>{let t="";for(let n=0;n<e.length;n++)t+=Ee(fe(e[n]*de)/de).toString(),n<e.length-1&&(t+="|");return t},b=e=>String.fromCharCode(97+e),he=e=>e.charCodeAt(0)-97,J=(e,t,n,o,f,c=[],a)=>{let h="";const u=o.map((r,s)=>c.includes(s)||r?"":b(s)).join(""),d=a||{},y=[];if(o.every(r=>E(r)))if(c.length===e-1){const r=e===2?0:T(e).find(s=>!c.includes(s));h=b(r),y.push(h.repeat(2))}else{let r=0;for(let s=0;s<e;s++)for(let l=s+1;l<e;l++){const i=b(r);!c.includes(s)&&!c.includes(l)&&(h+=i,y.push(i.repeat(t[s][l])),d[i]=[s,l],s>0&&!c.includes(s-1)&&!c.includes(l-1)&&y.push(b(s-1)+b(l-1).toUpperCase()+i)),r++}}else if(o.filter(r=>E(r)).length===2){const r=o.map((s,l)=>E(s)?l:null).filter(s=>s!==null);for(let s=0;s<e-1;s++)if(!c.includes(s)){const l=b(s);h+=l,s===r[0]?(d[l]=r,y.push(l.repeat(t[r[0]][r[1]]))):(y.push(l.repeat(2)),d[l]=[s])}if(c.length===e-1){const s=e===2?0:T(e).find(l=>!c.includes(l));h=b(s),y.push(h.repeat(2))}else for(let s=0;s<e;s++)for(let l=s+1;l<e;l++)if(!c.includes(s-1)&&!c.includes(l-1)){let i=t[s][l];if(s===r[0]||l===r[1]||l-s>1||i<2)continue;i%2===0&&(i/=2),y.push((b(s-1).toUpperCase()+b(l-1)+b(s-1)+b(l-1)).repeat(i))}}else if(o.filter(r=>E(r)).length===1){const r=o.findIndex(l=>E(l)),s=(r+1)%e;for(let l=0;l<e;l++)if(!c.includes(l)){const i=b(l);h+=i,y.push(i.repeat(2)),l===r?d[i]=[r,s,r]:d[i]=[l]}for(let l=0;l<e;l++)for(let i=l+1;i<e;i++)if(!c.includes(l)&&!c.includes(i)){let w=t[l][i];if(w<2)continue;l===r&&i===s||l===s&&i===r?(w%2===0&&(w/=2),y.push((b(l)+b(i)).repeat(w))):(i-l>1&&(w=t[i-1][i]),y.push((b(l)+b(i)).repeat(w)))}}else{for(let r=0;r<e;r++)if(!c.includes(r)){const s=b(r);h+=s,y.push(s.repeat(2)),d[s]=[r]}for(let r=0;r<e;r++)for(let s=r+1;s<e;s++)if(!c.includes(r)&&!c.includes(s)){const l=t[r][s];l>1&&y.push((b(r)+b(s)).repeat(l))}}if(!n.every(r=>r.every(s=>s===1))&&f.curvature>0){if(e===4&&n[0][1]>1!=n[2][3]>1&&t[0][1]>3&&t[2][3]>3)[0,1,2,3].some(r=>c.includes(r))||(n[0][1]>1&&y.push("abcdcb".repeat(L(t[0][1],t[1][2],t[0][2],n[0][1]))),n[2][3]>1&&y.push("abcdcb".repeat(L(t[2][3],t[1][2],t[1][3],n[2][3]))));else for(let r=1;r<e;r++)for(let s=0;s<r;s++)if(n[s][r]>1){if(s+2<e){const l=L(t[s+1][r+1],t[s][r],t[s][r+1],n[s][r]);l&&!c.includes(s)&&!c.includes(r)&&!c.includes(s+2)&&y.push((b(s)+b(r)+b(s+2)+b(r)).repeat(l))}if(s-1>=0){const l=L(t[s-1][r-1],t[s][r],t[s-1][r],n[s][r]);l&&!c.includes(s)&&!c.includes(r)&&!c.includes(s-1)&&y.push((b(s)+b(r)+b(s)+b(s-1)).repeat(l))}}}return{gens:h,subgens:u,rels:y,transforms:d}},ee=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e),A=(e,t,n)=>{let o,f,c;if(t===0)o=f=c=n;else{const a=n<.5?n*(1+t):n+t-n*t,h=2*n-a;o=ee(h,a,e+1/3),f=ee(h,a,e),c=ee(h,a,e-1/3)}return[o,f,c]},Q=[[10/360,.56,.91],[0/360,.59,.88],[316/360,.72,.86],[267/360,.84,.81],[343/360,.81,.75],[350/360,.65,.77],[23/360,.92,.75],[41/360,.86,.83],[115/360,.54,.76],[170/360,.57,.73],[189/360,.71,.73],[199/360,.76,.69],[217/360,.92,.76],[232/360,.97,.85]],Be={background:[0,0,0,1],glow:!1,shading:"ads",diffuse:"lambert",specular:!1,shininess:32,opacity:1,ambient:.2,roughness:.85,gouraud:!1,transparency:"oit",color:({word:e})=>A(e.length*.03%1,.75,.7)},Fe=Object.fromEntries(Object.entries({neon:{background:[0,0,0,1],glow:{exposure:1.75,strength:2,offset:{up:2,down:2},steps:3,pow:2},shading:!1,face:{opacity:.025},transparency:"blend",color:({word:e})=>A(e.length*.17%1,.5,.6)},disco:{background:[0,0,0,1],glow:{exposure:1.5,strength:2,offset:{up:2,down:2},steps:4,pow:2},face:{gouraud:!0,diffuse:"fresnel",opacity:.025},transparency:"blend",color:({word:e})=>A(...Q[e.length%Q.length])},synthwave:{background:[...A(.77,.6,.04),1],glow:{exposure:1.5,strength:3,offset:{up:3,down:3},steps:3,pow:2},shading:!1,face:{opacity:.015},afterImage:.7,transparency:"blend",color:({word:e})=>A((.5-e.length*.05%.5+.65)%1,.4,.6)},colorful:{background:[1,1,1,1],diffuse:"oren-nayar",specular:"cook-torrance",shininess:32,opacity:1,ambient:.2,gouraud:!1,face:{gouraud:!0,opacity:.1,diffuse:"fresnel",specular:!1},transparency:"oit",color:({word:e})=>A(e.length*.03%1,1,.8)},shiny:{background:[0,0,0,1],diffuse:"lambert",specular:"blinn-phong",shininess:32,opacity:1,ambient:.2,gouraud:!1,face:{gouraud:!0,opacity:.1,diffuse:"fresnel",specular:!1},transparency:"oit",color:({word:e})=>A(-(e.length*.07)%1,1,.8)},shape:{background:[1,1,1,1],transparency:"oit",face:{gouraud:!0,opacity:.2,diffuse:"fresnel"},color:({faceSize:e,type:t,idx:n,size:o})=>t==="face"?A((e-2)*.21%1,1,.8):A(n/o,.75,.5)},subShape:{background:[1,1,1,1],transparency:"oit",face:{gouraud:!0,opacity:.2,diffuse:"fresnel"},color:({subShape:e,type:t})=>t!=="vertex"?A(e*.21%1,1,.8):[1,1,1]},reflection:{background:[1,1,1,1],diffuse:"cel",face:{opacity:.6,gouraud:!1},transparency:"blend",color:({word:e,type:t,dimensions:n,draw:o})=>{const f=e.length?he(e[e.length-1])/n:0;return A(f%1,1,t==="face"?.6:o.face?0:.8)}},harlequin:{background:[...A(240/360,.23,.09),1],face:{opacity:.6},transparency:"oit",color:({word:e,idx:t,type:n})=>{const o=e.split("").map(c=>he(c)).reduce((c,a)=>c+a,0),f=[...Q[o%Q.length]];return t%2&&(f[2]*=.5),A(...f)}},pure:{background:[0,0,0,1],color:({word:e})=>A(e.length*.03%1,.75,.7)},facets:{background:[0,0,0,1],color:({faceIndex:e,faceSize:t})=>A(e/t,.75,.7)},monochrome:{background:[.12,.12,.12,1],diffuse:"reverse",ambient:0,face:{opacity:.1},transparency:"oit",color:()=>[1,1,1]},plain:{extended:!0,background:[1,1,1,1],glow:!1,shading:!1,color:({word:e,type:t,draw:n})=>A(e.length*.06%1,1,t==="face"?.6:n.face?.05:.5)},plainblack:{extended:!0,background:[1,1,1,1],shading:!1,color:({word:e,type:t})=>t==="face"?new Array(3).fill(1-Oe(.9,e.length+1)):[0,0,0]},normals:{extended:!0,background:[1,1,1,1],shading:"normal",color:()=>[0,0,0]},uvs:{extended:!0,background:[1,1,1,1],shading:"uv",color:()=>[0,0,0]}}).map(([e,t])=>[e,{...Be,...t,transparent:{}}])),Te=e=>{const t=e.toUpperCase();return e===t?e.toLowerCase():t},q=(e,t)=>{let n=t,o=0;for(;e.quotientMap[n];)o++,n=e.quotientMap[n];return o>1&&(e.quotientMap[t]=n),n},ae=(e,t,n)=>{const o=t,f=[[t,n]];for(;f.length>0;)if([t,n]=f.pop(),t>n&&([t,n]=[n,t]),t=q(e,t),n=q(e,n),t!==n){e.quotientMap[n]=t,e.seen.has(n)&&!e.seen.has(t)&&e.seen.add(t);const c=e.cosets.get(t),a=e.cosets.get(n);e.cosets.delete(n);for(const[h,u]of a)c.has(h)?f.push([c.get(h),u]):c.set(h,u)}return q(e,o)},ye=(e,t,n,o)=>{t=q(e,t);const f=e.cosets.get(t);f.has(n)?ae(e,f.get(n),o):f.set(n,o)},X=(e,t,n,o)=>{t=q(e,t);let f;const c=e.cosets.get(t);return c.has(n)?(f=q(e,c.get(n)),o!==void 0&&f!==o&&ae(e,o,f)):(o?f=o:(f=e.nextVertex++,e.cosets.set(f,new Map),e.unvisited.push(f)),ye(e,t,n,f),ye(e,f,Te(n),t)),f},we=function(e,t,n){let o=n;for(let f=t.length-1;f>0;f--)o=X(e,o,t[f]);X(e,o,t[0],n)},_e=function(e){if(!e.words){const t=q(e,1);e.words=new Map,e.words.set(t,""),e.currentWords=new Map,e.currentWords.set(t,""),e.lastWord="",e.lastCoset=t,e.remaining=[t],e.rootVertex&&e.rootNormals&&e.metric&&(e.vertices=new Map,e.vertices.set(t,e.rootVertex))}for(;e.remaining.length>0;){const t=e.remaining[0],n=q(e,t),o=e.cosets.get(n),f=e.words.get(n);if(o.size<e.gens.length*2)return;const c=[];for(let a=0;a<e.gens.length;a++){const h=e.gens[a],u=q(e,o.get(h));if(!e.words.has(u)){if(e.cosets.get(u).size<e.gens.length*2)return;c.push([h,u])}}e.remaining.shift();for(let a=0;a<c.length;a++){const[h,u]=c[a],d=h+f;if(e.words.set(u,d),e.currentWords.set(u,d),e.lastCoset=u,e.lastWord=d,e.remaining.push(u),e.vertices){let y=e.vertices.get(n);for(let r=0;r<e.transforms[h].length;r++){const s=e.transforms[h][r];y=le(y,e.rootNormals[s],e.metric)}e.vertices.set(u,y)}}}},be=(e,t)=>{let n=q(e,1);for(let o=t.length-1;o>=0;o--){const f=e.cosets.get(n);if(f.size<e.gens.length*2||(n=q(e,f.get(t[o])),e.cosets.get(n).size<e.gens.length*2))return}return n},ve=e=>{if(!e.cosets){e.unvisited=[1],e.cosets=new Map([[1,new Map]]),e.nextVertex=2,e.seen=new Set,e.quotientMap={};for(let t=0;t<e.subgens.length;t++)we(e,e.subgens[t],1)}e.limit=e.limit||1e3,e.done=!1;for(let t=0;t<e.limit;t++){let n=null;for(;e.unvisited.length>0;){const o=q(e,e.unvisited.shift());if(!e.seen.has(o)){e.seen.add(o),n=o;break}}if(n===null){e.done=!0;break}for(let o=0;o<e.gens.length;o++)X(e,n,e.gens[o].toUpperCase()),X(e,n,e.gens[o]);for(let o=0;o<e.rels.length;o++)we(e,e.rels[o],n)}},Pe=e=>(ve(e),e.cosets.size),je=e=>(ve(e),_e(e),e),Ue=e=>{if(e.dimensions===0)return!0;if(e.words.size<=e.dimensions)return!1;const t=new Set;for(let n=0;n<e.lastWord.length;n++){const o=e.lastWord[n];if(!(!o||t.has(o))){for(let f=0;f<e.transforms[o].length;f++)t.add(b(e.transforms[o][f]));if(t.size>=e.dimensions)return!0}}return!1},te=(e,t,n,o,f,c=null,a=null,h=new Map)=>{o.every(u=>!u)&&(o=o.map(()=>1)),c=c||o.map((u,d)=>re(u)?null:d).filter(u=>u!==null),a=a||{new:!0,dimensions:e,coxeter:t,stellation:n,mirrors:o,skips:c,...J(e,t,n,o,f,c),quotient:"",facet:[""],children:[]};for(let u=0;u<e;u++){if(c.includes(u))continue;const d=[...c,u],y=T(e).filter(w=>!d.includes(w)),r=d.sort().join("-");let s=!1;if(!h.has(r)){s=!0;const w={key:r,dimensions:e-d.length,coxeter:K(t,d),stellation:K(n,d),mirrors:D(o,d),skips:d,...J(e,t,n,o,f,d,a.transforms)};je(w),h.set(r,w)}const l=h.get(r),i=Array.from(l.words.values());if(Ue(l)){let w="";if(o.every(x=>E(x))){if(l.gens.length===1){const x=l.gens,O=t[a.transforms[x][0]][a.transforms[x][1]];(l.dimensions===1?O===2:O>2)&&(w+=x)}l.dimensions===0&&(w="")}else for(let x=0;x<e;x++)(!d.includes(x)||re(o[x])&&!o[x]&&!y.some(O=>t[O][x]!==2))&&(w+=b(x));let S={new:s,...l,quotient:w,facet:i,children:[]};l.dimensions>0&&(S=te(e,t,n,o,f,d,S,h)),a.children.push(S)}}if(c.length===0&&o.every(u=>E(u))&&a.dimensions>2){const u="s",d=ie(e-1).map((i,w)=>i.map((M,S)=>w===S+1||w===S-1?3:2)),y=ie(e-1).map(i=>i.map(()=>1)),r=T(e-1).map(()=>"s"),s=["s"];let l={new:!0,key:u,dimensions:e-1,coxeter:d,stellation:y,mirrors:r,skips:s,...J(e,d,y,r,f,s,a.transforms),quotient:"",facet:["","b","c"],children:[]};a.children.push(l)}if(a.children.length===0){console.info("No leaf found, digging deeper",c);for(let u=0;u<e;u++){if(c.includes(u))continue;const d=[...c,u];a.children.push(te(e,t,n,o,f,d,{new:!1,key:d.sort().join("-"),dimensions:e-d.length,coxeter:K(t,d),stellation:K(n,d),mirrors:D(o,d),quotient:"",facet:[""],skips:d,...J(e,t,n,o,f,d,a.transforms),children:[]},h))}}return a},He=(e,t,n)=>{const o=[],f=[],c=[];for(const[a,h]of e.currentWords){let u;if(h===""){const d=Ae(n.rootVertices);e.fundamentalVertices=new Map,u=T(t.dimensions).map(y=>Me(d[y],n.metric)),e.hashes={vertex:new Set,edge:new Set,face:new Set},e.fundamentalVertices.set("",u)}else{u=[...e.fundamentalVertices.get(h.slice(1))];const d=e.gens.indexOf(h[0]);for(let y=0;y<u.length;y++)u[y]=le(u[y],n.rootNormals[d],n.metric)}for(let d=0;d<u.length;d++){const y=I(u[d]);e.hashes.vertex.has(y)||(o.push({word:h,cosetId:a,vertices:[u[d]]}),e.hashes.vertex.add(y));for(let r=d+1;r<u.length;r++){const s=[u[d],u[r]].sort((l,i)=>{for(let w=0;w<l.length;w++){if(l[w]<i[w])return-1;if(l[w]>i[w])return 1}return 0}).map(l=>I(l)).join("-");e.hashes.edge.has(s)||(f.push({word:h,cosetId:a,vertices:[u[d],u[r]]}),e.hashes.edge.add(s));for(let l=r+1;l<u.length;l++){const i=[u[d],u[r],u[l]].sort((w,M)=>{for(let S=0;S<w.length;S++){if(w[S]<M[S])return-1;if(w[S]>M[S])return 1}return 0}).map(w=>I(w)).join("-");e.hashes.face.has(i)||(c.push({word:h,cosetId:a,vertices:[u[d],u[r],u[l]]}),e.hashes.face.add(i))}}e.fundamentalVertices.set(h,u)}e.currentWords.delete(a)}return[o,f,c]},De=(e,t,n=!1)=>{if(n){const o=e>0?1-e%2:0;return e>=t/2+o?2*(t-e)-1+o:2*e-o}return e>=t/2?2*(t-e)-1:2*e},Ke=(e,t,n,o)=>{const f=[],c=[];if(e.subdimensions===0)for(const[a,h]of e.currentWords)f.push({word:h,vertices:[e.vertices.get(a)]}),e.currentWords.delete(a);else if(e.subdimensions===1)for(const[a,h]of e.currentWords){const u={word:h,vertices:[]};for(let d=0;d<e.facet.length;d++){const y=be(o,h+e.facet[d]);y&&o.vertices.has(y)&&u.vertices.push(o.vertices.get(y))}u.vertices.length<2||(f.push(u),e.currentWords.delete(a))}else if(e.subdimensions===2)for(const[a,h]of e.currentWords){const u=e.mirrors.every(i=>!!i),d=e.mirrors.some(i=>E(i)),y=h.length%2?0:1,r=[];for(let i=0;i<e.facet.length;i++){const w=d?i:De(i,e.facet.length,u),M=be(o,h+e.facet[w]);M&&o.vertices.has(M)&&r.push(o.vertices.get(M))}if(r.length<3)continue;const s=r.length<e.facet.length;if(r.length===3){y&&([r[2],r[1]]=[r[1],r[2]]);const i={word:h,vertices:r,faceIndex:0,faceSize:3,partial:s};s?c.push(i):(f.push(i),e.currentWords.delete(a));continue}const l=new Array(t.dimensions).fill(0);for(let i=0;i<r.length;i++){const w=r[i];for(let M=0;M<w.length;M++)l[M]+=w[M]}for(let i=0;i<t.dimensions;i++)l[i]/=r.length;for(let i=0;i<r.length;i++){const w={word:h,vertices:[r[(i+y)%r.length],r[(i+(1-y))%r.length],l],faceIndex:i,faceSize:r.length,partial:s};s?c.push(w):(f.push(w),e.currentWords.delete(a))}}return{objects:f,partials:c}};let N,P,z;onmessage=({data:{first:e,space:t,dimensions:n,coxeter:o,stellation:f,mirrors:c,ambiance:a,draw:h,batch:u,hidden:d}})=>{var y,r;try{let s=!0;e&&(N=new Map,P=[0,0,0],z=te(n,o,f,c,t));const l=T(z.dimensions).join("-"),i=[],w=c.every(g=>!g),M={0:!0,1:h.edge&&!w,2:h.face&&!w},S=g=>{g.children.forEach(S);const v=M[g.dimensions],W=U[g.dimensions];if(g!=null&&g.new){i[g.dimensions]||(i[g.dimensions]={dimensions:g.dimensions,processing:h[W]?0:void 0,count:0,detail:[],aggregated:[],done:!0});const C=t.eigens.values;if(N.has(g.key))N.get(g.key).keys.push(g.key);else{let V=v?u:5;W==="edge"&&t.curvature<=0&&(V*=1.5);const F={...z,keys:[g.key],subgens:g.quotient,facet:g.facet,subdimensions:g.dimensions,mirrors:g.mirrors,limit:V,...g.dimensions===0&&!w?{rootVertex:t.rootVertex,rootNormals:t.rootNormals,metric:t.metric}:{}};N.set(g.key,F)}const j=N.get(g.key);j.done||(v?(je(j),C.some(V=>V<=0)?j.count=1/0:j.count=j.cosets.size):C.some(V=>V<=0)?(j.count=1/0,j.done=!0):j.count=Pe(j)),i[g.dimensions].detail.push({key:g.key,coxeter:g.coxeter,stellation:g.stellation,mirrors:g.mirrors,count:j.count,done:j.done});const k=i[g.dimensions].aggregated.find(({coxeter:V,stellation:F,mirrors:B})=>H(V,g.coxeter)&&H(F,g.stellation)&&H(B,g.mirrors));k?(k.done=k.done&&j.done,k.count+=j.count,k.key+=","+g.key):i[g.dimensions].aggregated.push({key:g.key,coxeter:g.coxeter,stellation:g.stellation,mirrors:g.mirrors,count:j.count,done:j.done}),h[W]&&j.words&&(i[g.dimensions].processing+=j.words.size),i[g.dimensions].count+=j.count,i[g.dimensions].done=i[g.dimensions].done&&j.done,s=s&&j.done}};z.children.forEach(S);const x=N.get(l);if(z.dimensions===2&&(z.currentWords=new Map([[1,""]]),z.facet=Array.from(x.words.values()),z.done=!0,N.set("",{...z,subgens:z.subgens,facet:z.facet,subdimensions:z.dimensions,mirrors:z.mirrors}),i[2]={dimensions:2,processing:1,count:0,detail:[{key:"",coxeter:z.coxeter,stellation:z.stellation,mirrors:z.mirrors,count:1,done:!0}],aggregated:[],done:!0}),i[0].done&&(!h.edge||(y=i[1])!=null&&y.done)&&(!h.face||(r=i[2])!=null&&r.done))for(let g of N.values())g.limit=200;const O=[];if(w){const g=He(x,z,t);for(let v=0;v<g.length;v++)h[U[v]]?(O.push({start:P[v],size:g[v].length,objects:[g[v]],partials:[]}),P[v]+=g[v].length):O.push(null)}else for(let g=0;g<i.length&&g<3;g++){if(!h[U[g]]){O.push(null);continue}const v={start:P[g],size:0,objects:[],partials:[]};for(let W=0;W<i[g].detail.length;W++){const C=i[g].detail[W];if(d.includes(C.key))continue;const j=N.get(C.key);if(j.currentWords.size){const{objects:k,partials:V}=Ke(j,z,t,x);v.objects.push(k),v.size+=k.length+V.length,P[g]+=k.length,v.partials.push(V)}}O.push(v)}const Y=[],ne=[],ze=z.dimensions>4?9:z.dimensions;for(let g=0;g<O.length;g++){const v=O[g];if(!v){Y.push(null),ne.push(null);continue}const W=[new Float32Array(v.size*3)];for(let k=0;k<g+1;k++)W.push(new Float32Array(v.size*ze));let C=0;const j=v.objects.concat(v.partials);for(let k=0;k<j.length;k++){const V=j[k];for(let F=0;F<V.length;F++){const B=V[F];for(let Z=0;Z<B.vertices.length;Z++){const xe=B.vertices[Z];for(let $=0;$<xe.length;$++)W[Z+1][C*ze+$]=xe[$]}const oe=Fe[a].color({word:B.word,key:B.key,subShape:k%v.objects.length,faceIndex:B.faceIndex,faceSize:B.faceSize,dimensions:z.dimensions,draw:h,idx:C,size:v.size,type:U[g]});W[0][C*3+0]=oe[0],W[0][C*3+1]=oe[1],W[0][C*3+2]=oe[2],C++}}Y.push(W),ne.push({start:v.start,size:v.size})}i.size=w?x.words.size:x.vertices.size,i.done=s,postMessage({polytope:i,infos:ne,data:Y},{options:{transfer:[Y.flat(1)]}})}catch(s){postMessage({error:s.message})}}})();
