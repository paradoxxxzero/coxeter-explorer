(function(){"use strict";const{abs:fe,cos:he,sin:ue,cosh:ae,sinh:ge,acos:pe,acosh:me,tan:we,min:de,max:xe,round:P,sqrt:be,sign:ye,floor:Me,log:ke,exp:E,PI:Ce}=Math,g=e=>String.fromCharCode(97+e),q=(e,n,t,s)=>{const r=[];for(let o=0;o<e;o++)r.push(g(o).repeat(2));for(let o=1;o<e;o++)for(let l=0;l<o;l++)r.push((g(l)+g(o)).repeat(n[o][l]));return r},L=(e,n,t,s)=>Object.fromEntries(q(e,n).map(r=>[r,""])),K=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?-1:1},N=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?1:-1},D=(e,n)=>{const t=new Map,s=Object.keys(e).sort(n);for(let r=0;r<s.length;r++){const o=s[r],[l,c]=[o,e[o]].sort(n);t.has(c)?t.set(c,[l,t.get(c)].sort()[0]):t.set(c,l)}return t},b=(e,n)=>{if(n.length===0||e.size===0)return n;const t=e._re_cache||new RegExp([...e.keys()].join("|"),"g");let s=n;do n=s,s=n.replace(t,r=>e.get(r));while(s!==n);return n},G=(e,n)=>{const t=new Map(e);for(e=[...e.entries()];e.length>0;){$();const[s,r]=e.pop();t.delete(s);const o=b(t,s),l=b(t,r);let c=!0;if(o===l)c=!1;else{const[i,u]=[o,l].sort(n);u!==s&&i!==r&&(t.set(u,i),e.push([u,i]),c=!1)}c&&t.set(s,r)}return t},J=function(e,n){if(n.length===0)return null;const t=Math.max(0,e.length-n.length);for(let s=t;s<e.length;s++)if(e[s]===n[0]&&e.slice(s+1)===n.slice(1,e.length-s))return{prefix:e.slice(0,s),suffix:n.slice(e.length-s)}},Q=function(e,n){if(n.length===0)return null;for(let t=0;t<e.length-n.length+1;t++)if(e.slice(t,t+n.length)===n)return{prefix:e.slice(0,t),suffix:e.slice(t+n.length)}},U=(e,n,t,s)=>{const r=J(e,t);if(r)return{s1:r.prefix+s,s2:n+r.suffix};const o=Q(e,t);if(o)return{s1:n,s2:o.prefix+s+o.suffix}},V=(e,n)=>{const t=new Map(e),s=[...e.entries()];for(let r=0;r<s.length;r++){$();const[o,l]=s[r];for(let c=0;c<s.length;c++){if(r===c)continue;const[i,u]=s[c],f=U(o,l,i,u);if(f){const h=b(e,f.s1),p=b(e,f.s2);if(h!==p){const[j,T]=[h,p].sort(n);t.set(T,j)}}}}return t},X=(e,n)=>V(G(e,n),n),Y=(e,n)=>{if(e.size!==n.size)return!1;const t=e.keys();for(;;){const{done:s,value:r}=t.next();if(s)return!0;if(e.get(r)!==n.get(r))return!1}},Z=(e,n)=>{for(e=D(e,n);;){const t=X(e,n);if(Y(t,e))return t._re_cache=new RegExp([...t.keys()].join("|"),"g"),t;e=t}};let W,A;const $=()=>{if(performance.now()-W>A)throw new Error("Timeout")},ee=(e,n)=>{const t=[50,100,E(n)*4,E(n)*10].map(s=>[s,s]).flat();for(let s=0;s<t.length;s++){A=t[s];try{return W=performance.now(),Z(e,s%2?K:N)}catch(r){if(r.message!=="Timeout")throw r}}throw new Error("Timeout")},y=(e,n)=>b(e,n),te=(e,n,t)=>{let s=0;for(let r=0;r<e.length;r++)s+=e[r]*n[r]*(r===e.length-1&&t||1);return s},ne=(e,n,t)=>{e=e.slice();const s=2*te(e,n,t);for(let r=0;r<e.length;r++)e[r]-=s*(t||r!==e.length-1?n[r]:0);return e};let M=new Map,B=new Set,m=[],k=[],R=[],v=0,w=new Map,d=[],C=null,x=!1,a=null;const z=(e,n,t)=>{v=0,m=[],k=[],R=[],M.clear(),B.clear(),w.clear(),w.set("",F("",e)),d=[""],C=t,a=n;const s=C.map((r,o)=>r==="s"?g(o):"").join("");x=s.length>0?new RegExp(`[^${s}]`,"g"):null},_=new ArrayBuffer(8),se=new Float64Array(_),I=new Int32Array(_);function re(e){return~~e===e?~~e:(se[0]=e,I[0]^I[1])}const O=10**4,oe=e=>{let n="";for(let t=0;t<e.length;t++)n+=re(P(e[t]*O)/O).toString(),t<e.length-1&&(n+="|");return n},le=(e,n)=>{const{rootVertex:t,mirrorsPlanes:s,curvature:r}=e;let o=t;for(let l=n.length-1;l>=0;l--)o=ne(o,s[n.charCodeAt(l)-97],r);return o};function F(e,n){const t=oe(n);if(M.has(t))return M.get(t);{const s=v+m.length;return M.set(t,s),m.push({vertex:n,word:e}),s}}function H(e,n){const t=w.get(e),s=w.get(n);if(t===s)return;const r=t>s?`${s}-${t}`:`${t}-${s}`;if(!B.has(r))return B.add(r),k.push({start:t,end:s,word:e,newWord:n}),!0}const S=(e,n,t)=>{if(n===t)return;if(w.has(t)){H(n,t);return}const s=le(e,t),r=F(t,s);return w.set(t,r),H(n,t),t},ce=e=>{const{dimensions:n}=e;let t;t=[];for(let s=0;s<d.length;s++){const r=d[s];for(let o=0;o<n;o++){const l=g(o),c=y(a,r+l);if(x&&c.replace(x,"").length%2)for(let i=0;i<C.length;i++){const u=g(i),f=y(a,c+u);if(f.replace(x,"").length%2)for(let h=0;h<C.length;h++){const p=g(h),j=y(a,f+p);if(j.replace(x,"").length%2)continue;const T=S(e,r,j);T&&t.push(T)}else{const h=S(e,r,f);h&&t.push(h)}}else{const i=S(e,r,c);i&&t.push(i)}}}return t},ie=e=>{const{dimensions:n}=e;let t=[""],s;const r=1e4;let o=d;do{s=[];for(let l=0;l<o.length;l++){const c=o[l];for(let i=0;i<n-1;i++){const u=g(i),f=y(a,c+u),h=S(e,c,f);h&&s.push(h)}}t=t.concat(s),o=s}while(s.length&&t.length<=r);if(t.length>r)throw new Error("Could not tile fundamental chamber");return t};onmessage=({data:{order:e,curvature:n,coxeter:t,stellated:s,stellation:r,mirrors:o,mirrorsPlanes:l,rootVertex:c,dimensions:i,uuid:u}})=>{try{let f=!1;if(e===0){const h=L(i,t,s?r:null,o);try{a=ee(h,i)}catch{a=new Map(Object.entries(h))}if(z(c,a,o),x)f=!0;else try{d=ie({curvature:n,mirrorsPlanes:l,rootVertex:c,dimensions:i})}catch(p){f=!0,z(c,a,o),console.warn(p)}}(e>0||f)&&(d=ce({curvature:n,mirrorsPlanes:l,rootVertex:c,dimensions:i})),postMessage({vertices:m,edges:k,faces:R,uuid:u}),v+=m.length,m=[],k=[],R=[]}catch(f){postMessage({error:f.message,uuid:u})}}})();
