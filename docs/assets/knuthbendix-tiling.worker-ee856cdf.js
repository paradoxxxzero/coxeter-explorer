(function(){"use strict";const D=(e,n,t)=>{let s=0;for(let r=0;r<e.length;r++)s+=e[r]*n[r]*(r===e.length-1&&t||1);return s},G=(e,n,t)=>{e=e.slice();const s=2*D(e,n,t);for(let r=0;r<e.length;r++)e[r]-=s*(t||r!==e.length-1?n[r]:0);return e},M=(e,n,t,s)=>{const r=C/e,l=C/n,o=C/t;return I(C/J(-b(r)*b(o)+k(r)*k(o)*((b(l)-b(s*r)*b(o))/(k(s*r)*k(o)))))},{abs:pe,cos:b,sin:k,tan:we,cosh:me,sinh:de,acos:J,acosh:be,atan:ye,min:Me,max:ke,round:I,sqrt:Ce,sign:Se,ceil:xe,floor:je,log:Be,exp:O,PI:C}=Math,_=new ArrayBuffer(8),Q=new Float64Array(_),$=new Int32Array(_);function U(e){return~~e===e?~~e:(Q[0]=e,$[0]^$[1])}const F=10**4,V=e=>{let n="";for(let t=0;t<e.length;t++)n+=U(I(e[t]*F)/F).toString(),t<e.length-1&&(n+="|");return n},f=e=>String.fromCharCode(97+e),X=(e,n,t,s,r)=>{const l=[];for(let o=0;o<e;o++)l.push(f(o).repeat(2));for(let o=1;o<e;o++)for(let c=0;c<o;c++)n[o][c]<1/0&&l.push((f(c)+f(o)).repeat(n[o][c]));if(t&&!t.every(o=>o.every(c=>c===1))&&r>0){if(e===4&&(t[0][1]>1||t[2][3]>1)&&n[0][1]>3&&n[2][3]>3)t[0][1]>1&&l.push("abcdcb".repeat(M(n[0][1],n[1][2],n[0][2],t[0][1]))),t[2][3]>1&&l.push("abcdcb".repeat(M(n[2][3],n[1][2],n[1][3],t[2][3])));else for(let o=1;o<e;o++)for(let c=0;c<o;c++)if(t[c][o]>1){if(c+2<e){const i=M(n[c+1][o+1],n[c][o],n[c][o+1],t[c][o]);l.push((f(c)+f(o)+f(c+2)+f(o)).repeat(i))}if(c-1>=0){const i=M(n[c-1][o-1],n[c][o],n[c-1][o],t[c][o]);l.push((f(c)+f(o)+f(c)+f(c-1)).repeat(i))}}}return l},Y=(e,n,t,s,r)=>Object.fromEntries(X(e,n,null,null,r).map(l=>[l,""])),Z=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?-1:1},ee=(e,n)=>{const t=e.length-n.length;return t!==0?Math.sign(t):e<=n?1:-1},te=(e,n)=>{const t=new Map,s=Object.keys(e).sort(n);for(let r=0;r<s.length;r++){const l=s[r],[o,c]=[l,e[l]].sort(n);t.has(c)?t.set(c,[o,t.get(c)].sort()[0]):t.set(c,o)}return t},y=(e,n)=>{if(n.length===0||e.size===0)return n;const t=e._re_cache||new RegExp([...e.keys()].join("|"),"g");let s=n;do n=s,s=n.replace(t,r=>e.get(r));while(s!==n);return n},ne=(e,n)=>{const t=new Map(e);for(e=[...e.entries()];e.length>0;){q();const[s,r]=e.pop();t.delete(s);const l=y(t,s),o=y(t,r);let c=!0;if(l===o)c=!1;else{const[i,u]=[l,o].sort(n);u!==s&&i!==r&&(t.set(u,i),e.push([u,i]),c=!1)}c&&t.set(s,r)}return t},se=function(e,n){if(n.length===0)return null;const t=Math.max(0,e.length-n.length);for(let s=t;s<e.length;s++)if(e[s]===n[0]&&e.slice(s+1)===n.slice(1,e.length-s))return{prefix:e.slice(0,s),suffix:n.slice(e.length-s)}},re=function(e,n){if(n.length===0)return null;for(let t=0;t<e.length-n.length+1;t++)if(e.slice(t,t+n.length)===n)return{prefix:e.slice(0,t),suffix:e.slice(t+n.length)}},oe=(e,n,t,s)=>{const r=se(e,t);if(r)return{s1:r.prefix+s,s2:n+r.suffix};const l=re(e,t);if(l)return{s1:n,s2:l.prefix+s+l.suffix}},ce=(e,n)=>{const t=new Map(e),s=[...e.entries()];for(let r=0;r<s.length;r++){q();const[l,o]=s[r];for(let c=0;c<s.length;c++){if(r===c)continue;const[i,u]=s[c],a=oe(l,o,i,u);if(a){const h=y(e,a.s1),R=y(e,a.s2);if(h!==R){const[v,A]=[h,R].sort(n);t.set(A,v)}}}}return t},le=(e,n)=>ce(ne(e,n),n),ie=(e,n)=>{if(e.size!==n.size)return!1;const t=e.keys();for(;;){const{done:s,value:r}=t.next();if(s)return!0;if(e.get(r)!==n.get(r))return!1}},fe=(e,n)=>{for(e=te(e,n);;){const t=le(e,n);if(ie(t,e))return t._re_cache=new RegExp([...t.keys()].join("|"),"g"),t;e=t}};let H,P;const q=()=>{if(performance.now()-H>P)throw new Error("Timeout")},he=(e,n)=>{const t=[50,100,O(n)*4,O(n)*10].map(s=>[s,s]).flat();for(let s=0;s<t.length;s++){P=t[s];try{return H=performance.now(),fe(e,s%2?Z:ee)}catch(r){if(r.message!=="Timeout")throw r}}throw new Error("Timeout")},S=(e,n)=>y(e,n);let x=new Map,E=new Set,p=[],j=[],W=[],z=0,w=new Map,m=[],B=null,d=!1,g=null;const L=(e,n,t)=>{z=0,p=[],j=[],W=[],x.clear(),E.clear(),w.clear(),w.set("",K("",e)),m=[""],B=t,g=n;const s=B.map((r,l)=>r==="s"?f(l):"").join("");d=s.length>0?new RegExp(`[^${s}]`,"g"):null},ue=(e,n)=>{const{rootVertex:t,mirrorsPlanes:s,curvature:r}=e;let l=t;for(let o=n.length-1;o>=0;o--)l=G(l,s[n.charCodeAt(o)-97],r);return l};function K(e,n){const t=V(n);if(x.has(t))return x.get(t);{const s=z+p.length;return x.set(t,s),p.push({vertex:n,word:e}),s}}function N(e,n){const t=w.get(e),s=w.get(n);if(t===s)return;const r=t>s?`${s}-${t}`:`${t}-${s}`;if(!E.has(r))return E.add(r),j.push({start:t,end:s,word:e,newWord:n}),!0}const T=(e,n,t)=>{if(n===t)return;if(w.has(t)){N(n,t);return}const s=ue(e,t),r=K(t,s);return w.set(t,r),N(n,t),t},ae=e=>{const{dimensions:n}=e;let t;t=[];for(let s=0;s<m.length;s++){const r=m[s];for(let l=0;l<n;l++){const o=f(l),c=S(g,r+o);if(d&&c.replace(d,"").length%2)for(let i=0;i<B.length;i++){const u=f(i),a=S(g,c+u);if(a.replace(d,"").length%2)for(let h=0;h<B.length;h++){const R=f(h),v=S(g,a+R);if(v.replace(d,"").length%2)continue;const A=T(e,r,v);A&&t.push(A)}else{const h=T(e,r,a);h&&t.push(h)}}else{const i=T(e,r,c);i&&t.push(i)}}}return t},ge=e=>{const{dimensions:n}=e;let t=[""],s;const r=1e4;let l=m;do{s=[];for(let o=0;o<l.length;o++){const c=l[o];for(let i=0;i<n-1;i++){const u=f(i),a=S(g,c+u),h=T(e,c,a);h&&s.push(h)}}t=t.concat(s),l=s}while(s.length&&t.length<=r);if(t.length>r)throw new Error("Could not tile fundamental chamber");return t};onmessage=({data:{order:e,curvature:n,coxeter:t,stellation:s,mirrors:r,mirrorsPlanes:l,rootVertex:o,dimensions:c,uuid:i}})=>{try{let u=!1;if(e===0){const a=Y(c,t,s,r,n);try{g=he(a,c)}catch(h){console.warn(h),g=new Map(Object.entries(a))}if(L(o,g,r),d||g.size<=c)u=!0;else try{m=ge({curvature:n,mirrorsPlanes:l,rootVertex:o,dimensions:c})}catch(h){u=!0,L(o,g,r),console.warn(h)}}(e>0||u)&&(m=ae({curvature:n,mirrorsPlanes:l,rootVertex:o,dimensions:c})),postMessage({vertices:p,edges:j,faces:W,order:e,uuid:i}),z+=p.length,p=[],j=[],W=[]}catch(u){postMessage({error:u.message,uuid:i})}}})();
