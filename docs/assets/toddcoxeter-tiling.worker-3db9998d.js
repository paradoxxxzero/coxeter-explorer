(function(){"use strict";const Q=(t,e=null,n=1,l=!1)=>{if(e===null&&(e=t,t=0),n===0)throw new Error("Step cannot be zero.");if(e<t&&n>0||e>t&&n<0){if(l)return[];n=-n}return new Array(Math.ceil((e-t)/n)).fill().map((r,s)=>t+s*n)},R=(t,e)=>t.length!==e.length?!1:t.every((n,l)=>Array.isArray(n)?R(n,e[l]):n===e[l]),L=(t,e)=>{let n=0;for(let l=0;l<t.length;l++)n+=t[l]*e[l];return n},X=(t,e)=>{const n=[];for(let l=0;l<t.length;l++)n[l]=t[l]-e[l];return n},F=(t,e)=>{const n=[];for(let l=0;l<t.length;l++)n[l]=t[l]*e;return n},E=(t,e)=>{const n=new Array(t.length);for(let l=0;l<t.length;l++){let r=0;for(let s=0;s<t[0].length;s++)r+=t[l][s]*e[s];n[l]=r}return n},Y=(t,e,n)=>X(t,F(E(z(n),e),2*L(E($(n),t),e))),Z=(t,e)=>e.some((n,l)=>n.some((r,s)=>l===s&&r===0))?F(t,1/t[t.length-1]):F(t,-1/te(U(L(E(e,t),t)))),$=t=>t.map((e,n)=>e.map((l,r)=>n===r&&l===0?1:l)),z=t=>t.map(e=>e.map(n=>U(n))),M=(t,e,n,l)=>{const r=I/t,s=I/e,o=I/n;return ee(I/x(-v(r)*v(o)+N(r)*N(o)*((v(s)-v(l*r)*v(o))/(N(l*r)*N(o)))))},{abs:U,cos:v,sin:N,tan:de,cosh:pe,sinh:me,acos:x,acosh:be,atan:ye,atan2:we,min:Ae,max:_e,round:ee,sqrt:te,sign:je,ceil:ke,floor:De,log:Ce,exp:Se,hypot:Ve,pow:ve,PI:I}=Math;function*ne(t,e){if(e<0||t.length<e)return;const n=Array.from(Array(e).keys());for(;;){yield n.map(r=>t[r]);let l=e-1;for(;l>=0&&n[l]>=t.length-e+l;)l--;if(l<0)return;for(let r=n[l]+1;l<e;l++,r++)n[l]=r}}const le=(t,e=2)=>Array.from(ne(t,e)),m=t=>String.fromCharCode(97+t),se=t=>t.charCodeAt(0)-97,G=(t,e,n,l=[])=>{const r=[];for(let s=0;s<t;s++)l.includes(s)||r.push(m(s).repeat(2));for(let s=1;s<t;s++)for(let o=0;o<s;o++)!l.includes(s)&&!l.includes(o)&&e[s][o]>1&&r.push((m(o)+m(s)).repeat(e[s][o]));if(!l.length&&n&&!n.every(s=>s.every(o=>o===1))){if(t===4&&n[0][1]>1!=n[2][3]>1&&e[0][1]>3&&e[2][3]>3)n[0][1]>1&&r.push("abcdcb".repeat(M(e[0][1],e[1][2],e[0][2],n[0][1]))),n[2][3]>1&&r.push("abcdcb".repeat(M(e[2][3],e[1][2],e[1][3],n[2][3])));else for(let s=1;s<t;s++)for(let o=0;o<s;o++)if(n[o][s]>1){if(o+2<t){const b=M(e[o+1][s+1],e[o][s],e[o][s+1],n[o][s]);r.push((m(o)+m(s)+m(o+2)+m(s)).repeat(b))}if(o-1>=0){const b=M(e[o-1][s-1],e[o][s],e[o-1][s],n[o][s]);r.push((m(o)+m(s)+m(o)+m(o-1)).repeat(b))}}}return r},H=t=>t!==""&&t!=="x",re=t=>isNaN(t)?1:+t,O=(t,e=[])=>t.map((n,l)=>e.includes(l)?"":m(l)).join(""),W=(t,e=[])=>t.map((n,l)=>e.includes(l)||n?"":m(l)).join(""),oe=(t,e,n,l)=>{const r=l.map((u,d)=>H(u)?null:d).filter(u=>u),s=G(t,e,n,r),o=O(l,r),b=W(l,r);return{gens:o,subgens:b,rels:s}},ae=(t,e,n,l)=>{const r=l.map((u,d)=>H(u)?null:d).filter(u=>u),s=G(t,e,n,r),o=O(l,r),b=[];for(let u=0;u<l.length;u++)if(l[u]){let d=m(u);for(let p=0;p<t;p++)e[u][p]===2&&!l[p]&&(d+=m(p));b.push({gens:o,subgens:d,rels:s,target:m(u)})}return b},fe=(t,e,n,l)=>{const r=l.map((d,p)=>H(d)?null:p).filter(d=>d),s=G(t,e,n,r),o=O(l,r),b=[],u=le(Q(t),t-2);for(let d=0;d<u.length;d++){const p=Array.from(new Set(u[d].concat(r))),k=G(t,e,n,p);let w=O(l,p);const i=W(l,p),y=q({gens:w,subgens:i,rels:k,cosets:{normal:[],reverse:[]},rows:[],words:[],limit:1e3}).words;if(y.length>2){let g="";for(let f=0;f<t;f++)p.includes(f)||(g+=m(f));for(let f=0;f<t;f++)if(!l[f]){let a=!0;for(let c=0;c<t;c++)if(!p.includes(c)&&e[c][f]!==2){a=!1;break}a&&(g+=m(f))}b.push({gens:o,subgens:g,rels:s,face:y,double:l.filter((f,a)=>!p.includes(a)).every(f=>!!f)})}}return b},ce=(t,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const n=t.normal[e.left_coset][e.rel[e.left]];if(n===void 0)break;e.left++,e.left_coset=n}for(;e.left!==e.right;){const n=t.reverse[e.right_target][e.rel[e.right]];if(n===void 0)break;e.right--,e.right_target=n}return e.left===e.right?(t.normal[e.left_coset][e.rel[e.right]]=e.right_target,t.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},q=t=>{const{gens:e,subgens:n,rels:l,cosets:r,rows:s,words:o,limit:b}=t,u=e.length,d=l.map(i=>[...i].map(y=>e.indexOf(y))),p=n.split("").map(i=>e.indexOf(i));if(r.normal.length===0){r.normal.push(new Array(u).fill()),r.reverse.push(new Array(u).fill());for(let i=0;i<p.length;i++)r.normal[0][p[i]]=0,r.reverse[0][p[i]]=0}for(s.length===0&&s.push(...d.map(i=>({rel:i,left:0,right:i.length-1,left_coset:0,right_target:0})));s.length&&r.normal.length<b;){for(;;){let g=!1;for(let f=s.length-1;f>=0;f--)ce(r,s[f])&&(g=!0,s.splice(f,1));if(!g)break}const i=r.normal.length;let y=!1;for(let g=0;g<r.normal.length;g++){const f=r.normal[g];for(let a=0;a<f.length;a++){let c=f[a];if(c===void 0){c=r.normal.length,r.normal.push(new Array(u).fill()),r.reverse.push(new Array(u).fill()),r.normal[g][a]=c,r.reverse[c][a]=g,s.push(...d.map(h=>({rel:h,left:0,right:h.length-1,left_coset:i,right_target:i}))),y=!0;break}}if(y)break}}s.length||(t.done=!0),o.length===0&&(o[0]="");let k=!0,w=r.normal.length;for(;ue(r.normal.length,o)&&k&&--w;){k=!1;for(let i=0;i<o.length;i++){if(o[i]===void 0)continue;const y=r.normal[i];for(let g=0;g<y.length;g++){const f=y[g];f===void 0||o[f]!==void 0||(o[f]=o[i]+e[g],k=!0)}}}return k||console.warn("Hole in the cosets"),w===0&&console.warn("Max iterations reached"),{cosets:r,rows:s,words:o}},ue=(t,e)=>{for(let n=0;n<t;n++)if(e[n]===void 0)return!0;return!1};let _=null,T=null,B=null,C=null;const ie=(t,e,n,l)=>{if(C&&t===C.dimensions&&R(e,C.coxeter)&&R(n,C.stellation)&&R(l,C.mirrors)){_.lastDrawn=0,_.done=!1,T.forEach(s=>{s.lastDrawn=0,s.done=!1}),B.forEach(s=>{s.lastDrawn=0,s.done=!1});return}C={dimensions:t,coxeter:e,stellation:n,mirrors:l};const r=()=>({cosets:{normal:[],reverse:[]},rows:[],words:[],done:!1,lastDrawn:0});_={...oe(t,e,n,l),...r()},T=ae(t,e,n,l).map(s=>({...s,...r()})),B=fe(t,e,n,l).map(s=>({...s,...r(),toRetry:new Set}))},ge=(t,e)=>{const{rootVertex:n,rootNormals:l,metric:r}=t;let s=n;for(let o=0;o<e.length;o++)s=Y(s,l[e.charCodeAt(o)-97],r);return s},S=(t,e)=>{for(let n=0;n<t.length;n++){const l=se(t[n]),r=_.cosets.normal[e][l];if(r===void 0)return;e=r}return e};onmessage=({data:{order:t,curvature:e,metric:n,coxeter:l,stellation:r,mirrors:s,rootVertices:o,rootNormals:b,dimensions:u,uuid:d}})=>{t===0&&ie(u,l,r,s);let p=Z(E(o,s.map(w=>re(w))),n);const k=(t+1)*(e>0?500:100);try{let w=[],i=[],y=[],g=[];if(!_.done){_.limit=k,q(_);for(let f=_.lastDrawn;f<_.words.length;f++){const a=_.words[f];if(a===void 0){w.push({vertex:new Array(u).fill(NaN),word:""});continue}const c=ge({rootVertex:p,rootNormals:b,metric:n},a);w.push({vertex:c,word:a,i:f}),_.lastDrawn=f+1}}for(let f=0;f<T.length;f++){const a=T[f];a.done||(a.limit=k*(e>0?1:e<0?1.5:3),q(a));const c=S(a.target,0);for(let h=a.lastDrawn;h<a.words.length;h++){const A=a.words[h];if(A===void 0)continue;const j=S(A,0),D=S(A,c);if(j===void 0||D===void 0){a.lastDrawn=h;break}i.push({start:j,end:D,word:A}),a.lastDrawn=h+1}}for(let f=0;f<B.length;f++){const a=B[f];a.done||(a.limit=k*(e>0?1:e<0?1.5:2.5),q(a));const c=[];for(let h=0;h<a.face.length;h++)c.push(S(a.face[h],0));for(const h of a.toRetry){const A=a.words[h],j=[];for(let D=0;D<c.length;D++){const V=c[J(D,c.length,a.double)];if(V===void 0)continue;const P=S(A,V);P!==void 0&&j.push(P)}j.length===c.length?(y.push({vertices:j,word:A,len:c.length}),a.toRetry.delete(h)):g.push({vertices:j,word:A,len:c.length})}for(let h=a.lastDrawn;h<a.words.length;h++){let A=!1;const j=a.words[h],D=[];for(let V=0;V<c.length;V++){const P=c[J(V,c.length,a.double)];if(P===void 0){A=!0;continue}const K=S(j,P);if(K===void 0){A=!0;continue}D.push(K)}A?(g.push({vertices:D,word:j,len:c.length}),a.toRetry.add(h)):y.push({vertices:D,word:j,len:c.length}),a.lastDrawn=h+1}}postMessage({vertices:w,edges:i,faces:y,partials:g,order:t,uuid:d})}catch(w){postMessage({error:w.message,uuid:d})}};const J=(t,e,n=!1)=>{if(n){const l=t>0?1-t%2:0;return t>=e/2+l?2*(e-t)-1+l:2*t-l}return t>=e/2?2*(e-t)-1:2*t}})();
