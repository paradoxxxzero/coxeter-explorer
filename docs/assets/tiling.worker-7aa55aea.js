(function(){"use strict";const u={...{p:5,q:2,r:2,s:3,t:2,u:4,pDiv:1,qDiv:1,rDiv:1,sDiv:1,tDiv:1,uDiv:1,x:1,y:0,z:0,w:0,dimensions:4,order:10,segments:32,curve:!0,vertices:!1,edges:!0,stellation:!1,light:1.5,thickness:1,projection:"stereographic",controls:"orbit",ambiance:"neon"}},N=(e,t=!1)=>{Object.assign(u,e),t&&window.history.pushState(null,null,"#"+btoa(JSON.stringify(u)))},{abs:w,cos:J,sin:ke,cosh:Te,sinh:Ce,acos:De,acosh:He,min:Me,max:Se,round:K,sqrt:b,sign:j,floor:je,log:Ae,PI:P}=Math,i={coxeter:null,vertices:[],edges:[],words:new Map,rules:new Set,edgeHashes:new Set,vertexHashes:new Set,wordsToConsider:[],rootVertices:null,rootVertex:null,gram:null,mirrors:null},$=e=>{Object.assign(i,e)},G=(e,t)=>{const n=e.length-t.length;return n!==0?Math.sign(n):e<=t?-1:1},Q=(e,t)=>{const n=e.length-t.length;return n!==0?Math.sign(n):e<=t?1:-1},U=(e,t)=>{const n=new Map,s=Object.keys(e).sort(t);for(let r=0;r<s.length;r++){const o=s[r],[c,l]=[o,e[o]].sort(t);n.has(l)?n.set(l,[c,n.get(l)].sort()[0]):n.set(l,c)}return n},x=(e,t)=>{if(t.length===0||e.size===0)return t;const n=e._re_cache||new RegExp([...e.keys()].join("|"),"g");let s=t;do t=s,s=t.replace(n,r=>e.get(r));while(s!==t);return t},X=(e,t)=>{const n=new Map(e);for(e=[...e.entries()];e.length>0;){B();const[s,r]=e.pop();n.delete(s);const o=x(n,s),c=x(n,r);let l=!0;if(o===c)l=!1;else{const[h,g]=[o,c].sort(t);g!==s&&h!==r&&(n.set(g,h),e.push([g,h]),l=!1)}l&&n.set(s,r)}return n},Y=function(e,t){if(t.length===0)return null;const n=Math.max(0,e.length-t.length);for(let s=n;s<e.length;s++)if(e[s]===t[0]&&e.slice(s+1)===t.slice(1,e.length-s))return{prefix:e.slice(0,s),suffix:t.slice(e.length-s)}},Z=function(e,t){if(t.length===0)return null;for(let n=0;n<e.length-t.length+1;n++)if(e.slice(n,n+t.length)===t)return{prefix:e.slice(0,n),suffix:e.slice(n+t.length)}},m=(e,t,n,s)=>{const r=Y(e,n);if(r)return{s1:r.prefix+s,s2:t+r.suffix};const o=Z(e,n);if(o)return{s1:t,s2:o.prefix+s+o.suffix}},ee=(e,t)=>{const n=new Map(e),s=[...e.entries()];for(let r=0;r<s.length;r++){B();const[o,c]=s[r];for(let l=0;l<s.length;l++){if(r===l)continue;const[h,g]=s[l],v=m(o,c,h,g);if(v){const k=x(e,v.s1),T=x(e,v.s2);if(k!==T){const[d,p]=[k,T].sort(t);n.set(p,d)}}}}return n},te=(e,t)=>ee(X(e,t),t),ne=(e,t)=>{if(e.size!==t.size)return!1;const n=e.keys();for(;;){const{done:s,value:r}=n.next();if(s)return!0;if(e.get(r)!==t.get(r))return!1}},se=(e,t)=>{for(e=U(e,t);;){const n=te(e,t);if(ne(n,e))return n._re_cache=new RegExp([...n.keys()].join("|"),"g"),n;e=n}};let A,V;const B=()=>{if(performance.now()-A>V)throw new Error("Timeout")},re=e=>{const t=[50,100,250].map(n=>[n,n]).flat();for(let n=0;n<t.length;n++){V=t[n];try{return A=performance.now(),se(e,n%2?G:Q)}catch(s){if(s.message!=="Timeout")throw s}}throw new Error("Timeout")},oe=(e,t,n,s,r,o,c)=>re(e===3?{aa:"",bb:"",cc:"",["ab".repeat(t)]:"",["ac".repeat(n)]:"",["bc".repeat(s)]:""}:{aa:"",bb:"",cc:"",dd:"",["ab".repeat(t)]:"",["ac".repeat(n)]:"",["ad".repeat(s)]:"",["bc".repeat(r)]:"",["bd".repeat(o)]:"",["cd".repeat(c)]:""}),ie=e=>x(i.rules,e),f={curvature:0,edges:[],vertices:[],ranges:[]},ce=e=>{Object.assign(f,e)},le=e=>{if(e.length===3)return e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1];if(e.length===4)return e[0][0]*(e[1][1]*e[2][2]*e[3][3]+e[1][2]*e[2][3]*e[3][1]+e[1][3]*e[2][1]*e[3][2]-e[1][3]*e[2][2]*e[3][1]-e[1][2]*e[2][1]*e[3][3]-e[1][1]*e[2][3]*e[3][2])+e[0][1]*(e[1][0]*e[2][3]*e[3][2]+e[1][2]*e[2][0]*e[3][3]+e[1][3]*e[2][2]*e[3][0]-e[1][3]*e[2][0]*e[3][2]-e[1][2]*e[2][3]*e[3][0]-e[1][0]*e[2][2]*e[3][3])+e[0][2]*(e[1][0]*e[2][1]*e[3][3]+e[1][1]*e[2][3]*e[3][0]+e[1][3]*e[2][0]*e[3][1]-e[1][3]*e[2][1]*e[3][0]-e[1][1]*e[2][0]*e[3][3]-e[1][0]*e[2][3]*e[3][1])+e[0][3]*(e[1][0]*e[2][2]*e[3][1]+e[1][1]*e[2][0]*e[3][2]+e[1][2]*e[2][1]*e[3][0]-e[1][2]*e[2][0]*e[3][1]-e[1][1]*e[2][2]*e[3][0]-e[1][0]*e[2][1]*e[3][2])},ae=e=>{const t=le(e);return w(t)<1e-8?0:j(t)},R=(e,t,n=null)=>{const s=n===null?f.curvature:n;let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o]*(o===e.length-1&&s||1);return r},ue=(e,t)=>{e=e.slice();const n=2*R(e,t);for(let s=0;s<e.length;s++)e[s]-=n*(f.curvature||s!==e.length-1?t[s]:0);return e},fe=e=>{if(e=e.slice(),f.curvature===0){for(let n=0;n<e.length;n++)e[n]/=e[e.length-1];return e}const t=(f.curvature===-1&&j(e[e.length-1])||1)/b(w(R(e,e)));for(let n=0;n<e.length;n++)e[n]*=t;return e},he=e=>{const t=new Array(u.dimensions).fill().map(()=>new Array(u.dimensions).fill(0));return t[0][0]=1,t[1][0]=e[1][0],t[1][1]=b(1-t[1][0]*t[1][0]),t[2][0]=e[2][0],t[2][1]=(e[2][1]-t[2][0]*t[1][0])/t[1][1],t[2][2]=b(w(1-t[2][0]*t[2][0]-t[2][1]*t[2][1])),u.dimensions===4&&(t[3][0]=e[3][0],t[3][1]=(e[3][1]-t[3][0]*t[1][0])/t[1][1],t[3][2]=(e[3][2]-t[3][0]*t[2][0]-t[3][1]*t[2][1])/t[2][2],t[3][3]=b(w(1-t[3][0]*t[3][0]-t[3][1]*t[3][1]-t[3][2]*t[3][2]))),t[t.length-1][t.length-1]=f.curvature?t[t.length-1][t.length-1]*f.curvature:1,t},W=(e,[t,n,s,r])=>{const o=new Array(u.dimensions);return o[0]=t,o[1]=(n-e[1][0]*o[0])/e[1][1],o[2]=(s-e[2][0]*o[0]-e[2][1]*o[1])/e[2][2],u.dimensions===4&&(o[3]=(r-e[3][0]*o[0]-e[3][1]*o[1]-e[3][2]*o[2])/e[3][3]),o[o.length-1]*=f.curvature||1,fe(o)},ge=(e,t)=>{for(let n=0;n<e.length;n++)if(w(e[n]-t[n])>1e-8)return!1;return!0},de=e=>{let t=i.rootVertex;for(let n=e.length-1;n>=0;n--)t=ue(t,i.mirrors[e.charCodeAt(n)-97]);return t},z=new ArrayBuffer(8),pe=new Float64Array(z),_=new Int32Array(z);function we(e){return~~e===e?~~e:(pe[0]=e,_[0]^_[1])}const q=10**4,C=e=>{let t="";for(let n=0;n<e.length;n++)t+=we(K(e[n]*q)/q).toString(),n<e.length-1&&(t+="|");return t},O=e=>{const{dimensions:t,stellation:n,pDiv:s,qDiv:r,rDiv:o,sDiv:c,tDiv:l,uDiv:h,x:g,y:v,z:k,w:T}=e;let{p:d,q:p,r:y,s:D,t:H,u:M}=e;n&&(d/=s,p/=r,y/=o,D/=c,H/=l,M/=h);const a={coxeter:t===3?[[-1,d,p],[d,-1,y],[p,y,-1]]:t===4?[[-1,d,p,y],[d,-1,D,H],[p,D,-1,M],[y,H,M,-1]]:null,vertices:[],edges:[],words:new Map,edgeHashes:new Set,vertexHashes:new Set,wordsToConsider:[""],rootVertices:null,rootVertex:null};a.gram=a.coxeter.map(L=>L.map(S=>-J(P/S))),ce({curvature:ae(a.gram)}),a.mirrors=he(a.gram),a.rootVertices=a.mirrors.map((L,S)=>W(a.mirrors,new Array(t).fill(0).map((Be,ye)=>S===ye?a.curvature||1:0))),a.rootVertex=W(a.mirrors,[g?1:0,v?1:0,k?1:0,T?1:0]),a.words.set("",a.rootVertex),a.rules=oe(t,e.p,e.q,e.r,e.s,e.t,e.u),$(a)},E=(e,t,n)=>{const s=String.fromCharCode(97+t);if(e.slice(-1)===s)return;const r=ie(e+s);if(i.words.has(r)){const c=i.words.get(r);I(e,r,n,c);return}const o=de(r);return i.words.set(r,o),F(o,e),I(e,r,n,o),r},xe=()=>{let e=[""],t,n=25;F(i.rootVertex,"");do{t=[];for(let s=0;s<i.wordsToConsider.length;s++){const r=i.wordsToConsider[s],o=i.words.get(r);for(let c=0;c<u.dimensions-1;c++){const l=E(r,c,o);l&&t.push(l)}}e.push(...t),i.wordsToConsider=t}while(t.length&&n--);if(n<0)throw new Error("Could not tile fundamental chamber");i.wordsToConsider=e},ve=()=>{let e;e=[];for(let t=0;t<i.wordsToConsider.length;t++){const n=i.wordsToConsider[t],s=i.words.get(n);for(let r=0;r<u.dimensions;r++){const o=E(n,r,s);o&&e.push(o)}}i.wordsToConsider=e};function F(e,t){const n=C(e);i.vertexHashes.has(n)||(i.vertexHashes.add(n),i.vertices.push({vertex:e,word:t}))}function I(e,t,n,s){const r=C(n),o=C(s);if(r===o)return;const c=[r,o].sort().join("/");if(!i.edgeHashes.has(c)&&(i.edgeHashes.add(c),!ge(n,s))){const l=n.slice(),h=s.slice();return i.edges.push({start:l,end:h,word:e,newWord:t}),!0}}onmessage=({data:{C:e,order:t,uuid:n}})=>{try{if(N(e),t===0){O(e);try{xe()}catch(s){s.message==="Could not tile fundamental chamber"&&O(e)}}else i.vertices=[],i.edges=[],ve();postMessage({R:f,vertices:i.vertices,edges:i.edges,uuid:n})}catch(s){throw s.uuid=n,s}}})();
