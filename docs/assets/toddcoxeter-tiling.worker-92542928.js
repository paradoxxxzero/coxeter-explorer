(function(){"use strict";const h=t=>String.fromCharCode(97+t),b=(t,e)=>{const n=[];for(let s=0;s<t;s++)n.push(h(s).repeat(2));for(let s=1;s<t;s++)for(let l=0;l<s;l++)n.push((h(l)+h(s)).repeat(e[s][l]));return n},V=(t,e,n,s)=>{const l=b(t,e),o=[...Array(t).keys()].map(i=>h(i)).join(""),g=n.map((i,r)=>i?"":h(r)).join("");return x(o,g,l,s)},E=(t,e,n,s)=>{const l=b(t,e),o=[...Array(t).keys()].map(i=>h(i)).join(""),g={};for(let i=0;i<n.length;i++)if(n[i]){let r=h(i);for(let c=0;c<t;c++)e[i][c]===2&&(n[c]||(r+=h(c)));g[h(i)]=x(o,r,l,s)}return g},O=(t,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const n=t.normal[e.left_coset][e.rel[e.left]];if(n===void 0)break;e.left++,e.left_coset=n}for(;e.left!==e.right;){const n=t.reverse[e.right_target][e.rel[e.right]];if(n===void 0)break;e.right--,e.right_target=n}return e.left===e.right?(t.normal[e.left_coset][e.rel[e.right]]=e.right_target,t.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},x=(t,e,n,s)=>{const l=t.length;n=n.map(r=>[...r].map(c=>t.indexOf(c))),e=e.split("").map(r=>t.indexOf(r));const o={normal:[new Array(l).fill()],reverse:[new Array(l).fill()]},g=n.map(r=>({rel:r,left:0,right:r.length-1,left_coset:0,right_target:0}));for(const r of e)o.normal[0][r]=0,o.reverse[0][r]=0;for(;g.length&&o.normal.length<s;){for(;;){let f=!1;for(let a=g.length-1;a>=0;a--)O(o,g[a])&&(f=!0,g.splice(a,1));if(!f)break}const r=o.normal.length;let c=!1;for(let f=0;f<o.normal.length;f++){const a=o.normal[f];for(let d=0;d<a.length;d++){let p=a[d];if(p===void 0){p=o.normal.length,o.normal.push(new Array(l).fill()),o.reverse.push(new Array(l).fill()),o.normal[f][d]=p,o.reverse[p][d]=f,g.push(...n.map(m=>({rel:m,left:0,right:m.length-1,left_coset:r,right_target:r}))),c=!0;break}}if(c)break}}const i=new Array(o.normal.length).fill();for(i[0]="";i.some(r=>r===void 0);)for(let r=0;r<i.length;r++){if(i[r]===void 0)continue;const c=o.normal[r];for(let f=0;f<c.length;f++){const a=c[f];i[a]===void 0&&(i[a]=i[r]+h(f))}}return i},W=(t,e,n)=>{let s=0;for(let l=0;l<t.length;l++)s+=t[l]*e[l]*(l===t.length-1&&n||1);return s},v=(t,e,n)=>{t=t.slice();const s=2*W(t,e,n);for(let l=0;l<t.length;l++)t[l]-=s*(n||l!==t.length-1?e[l]:0);return t},_=(t,e)=>{const{rootVertex:n,mirrorsPlanes:s,curvature:l}=t;let o=n;for(let g=0;g<e.length;g++)o=v(o,s[e.charCodeAt(g)-97],l);return o};onmessage=({data:{order:t,curvature:e,mirrorsPlanes:n,coxeter:s,mirrors:l,rootVertex:o,dimensions:g,uuid:i}})=>{const r=t*100,c=(t+1)*100;try{let f=[],a=[];const d=V(g,s,l,c);for(let u=0;u<d.length;u++){const y=d[u],A=_({rootVertex:o,mirrorsPlanes:n,curvature:e},y);u>r&&f.push({vertex:A,word:y})}const p=E(g,s,l,c),m=Object.entries(p);for(let u=0;u<m.length;u++){const[y,A]=m[u],C=o,L=_({rootVertex:C,mirrorsPlanes:n,curvature:e},y);for(let j=0;j<A.length;j++){const k=A[j],M=_({rootVertex:C,mirrorsPlanes:n,curvature:e},k),S=_({rootVertex:L,mirrorsPlanes:n,curvature:e},k);j>r&&a.push({start:M,end:S,word:k})}}postMessage({vertices:f,edges:a,uuid:i})}catch(f){postMessage({error:f.message,uuid:i})}}})();
