(function(){"use strict";const m=n=>String.fromCharCode(97+n),j=(n,e)=>{const l=[];for(let t=0;t<n;t++)l.push(m(t).repeat(2));for(let t=1;t<n;t++)for(let r=0;r<t;r++)l.push((m(r)+m(t)).repeat(e[t][r]));return l},v=(n,e,l)=>{const t=j(n,e),r=[...Array(n).keys()].map(f=>m(f)).join(""),a=l.map((f,s)=>f?"":m(s)).join("");return{gens:r,subgens:a,rels:t}},M=(n,e,l)=>{const t=j(n,e),r=[...Array(n).keys()].map(f=>m(f)).join(""),a=[];for(let f=0;f<l.length;f++)if(l[f]){let s=m(f);for(let i=0;i<n;i++)e[f][i]===2&&(l[i]||(s+=m(i)));a.push({gens:r,subgens:s,rels:t,edgeMirror:m(f)})}return a},P=(n,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const l=n.normal[e.left_coset][e.rel[e.left]];if(l===void 0)break;e.left++,e.left_coset=l}for(;e.left!==e.right;){const l=n.reverse[e.right_target][e.rel[e.right]];if(l===void 0)break;e.right--,e.right_target=l}return e.left===e.right?(n.normal[e.left_coset][e.rel[e.right]]=e.right_target,n.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},C=({gens:n,subgens:e,rels:l,cosets:t,rows:r,words:a,limit:f})=>{const s=n.length;if(l=l.map(i=>[...i].map(c=>n.indexOf(c))),e=e.split("").map(i=>n.indexOf(i)),t.normal.length===0){t.normal.push(new Array(s).fill()),t.reverse.push(new Array(s).fill());for(let i=0;i<e.length;i++)t.normal[0][e[i]]=0,t.reverse[0][e[i]]=0}for(r.length===0&&r.push(...l.map(i=>({rel:i,left:0,right:i.length-1,left_coset:0,right_target:0})));r.length&&t.normal.length<f;){for(;;){let g=!1;for(let u=r.length-1;u>=0;u--)P(t,r[u])&&(g=!0,r.splice(u,1));if(!g)break}const i=t.normal.length;let c=!1;for(let g=0;g<t.normal.length;g++){const u=t.normal[g];for(let o=0;o<u.length;o++){let h=u[o];if(h===void 0){h=t.normal.length,t.normal.push(new Array(s).fill()),t.reverse.push(new Array(s).fill()),t.normal[g][o]=h,t.reverse[h][o]=g,r.push(...l.map(d=>({rel:d,left:0,right:d.length-1,left_coset:i,right_target:i}))),c=!0;break}}if(c)break}}for(a.length===0&&(a[0]="");V(t.normal.length,a);)for(let i=0;i<a.length;i++){if(a[i]===void 0)continue;const c=t.normal[i];for(let g=0;g<c.length;g++){const u=c[g];a[u]===void 0&&(a[u]=a[i]+m(g))}}return{cosets:t,rows:r,words:a}},V=(n,e)=>{for(let l=0;l<n;l++)if(e[l]===void 0)return!0;return!1},b=(n,e,l)=>{let t=0;for(let r=0;r<n.length;r++)t+=n[r]*e[r]*(r===n.length-1&&l||1);return t},L=(n,e,l)=>{n=n.slice();const t=2*b(n,e,l);for(let r=0;r<n.length;r++)n[r]-=t*(l||r!==n.length-1?e[r]:0);return n};let p=null,y=null;const E=(n,e,l)=>{const t=()=>({cosets:{normal:[],reverse:[]},rows:[],words:[]});p={...v(n,e,l),...t()},y=M(n,e,l).map(r=>({...r,...t()}))},_=(n,e)=>{const{rootVertex:l,mirrorsPlanes:t,curvature:r}=n;let a=l;for(let f=0;f<e.length;f++)a=L(a,t[e.charCodeAt(f)-97],r);return a};onmessage=({data:{order:n,curvature:e,mirrorsPlanes:l,coxeter:t,mirrors:r,rootVertex:a,dimensions:f,uuid:s}})=>{n===0&&E(f,t,r);const i=(n+1)*250;try{let c=[],g=[],u=p.words.length;p.limit=i,C(p);for(let o=u;o<p.words.length;o++){const h=p.words[o],d=_({rootVertex:a,mirrorsPlanes:l,curvature:e},h);c.push({vertex:d,word:h})}for(let o=0;o<y.length;o++){const h=y[o],d=h.words.length;h.limit=i,C(h);const x=a.slice(),O=_({rootVertex:x,mirrorsPlanes:l,curvature:e},h.edgeMirror);for(let k=d;k<h.words.length;k++){const A=h.words[k],S=_({rootVertex:x,mirrorsPlanes:l,curvature:e},A),R=_({rootVertex:O,mirrorsPlanes:l,curvature:e},A);g.push({start:S,end:R,word:A})}}postMessage({vertices:c,edges:g,uuid:s})}catch(c){postMessage({error:c.message,uuid:s})}}})();
