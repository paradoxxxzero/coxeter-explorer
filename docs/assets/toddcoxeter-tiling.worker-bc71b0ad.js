(function(){"use strict";const $=(n,e,i)=>{let d=0;for(let l=0;l<n.length;l++)d+=n[l]*e[l]*(l===n.length-1&&i||1);return d},q=(n,e,i)=>{n=n.slice();const d=2*$(n,e,i);for(let l=0;l<n.length;l++)n[l]-=d*(i||l!==n.length-1?e[l]:0);return n},S=(n,e,i,d)=>{const l=E/n,g=E/e,s=E/i;return L(E/H(-I(l)*I(s)+V(l)*V(s)*((I(g)-I(d*l)*I(s))/(V(d*l)*V(s)))))},{abs:B,cos:I,sin:V,tan:Z,cosh:ee,sinh:te,acos:H,acosh:ne,atan:se,min:re,max:le,round:L,sqrt:ae,sign:oe,ceil:ie,floor:fe,log:ce,exp:he,PI:E}=Math,x=n=>[].concat(...n.map((e,i)=>n.slice(i+1).map(d=>[e,d]))),y=n=>String.fromCharCode(97+n),G=n=>n.charCodeAt(0)-97,z=(n,e,i,d,l)=>{const g=[];for(let s=0;s<n;s++)g.push(y(s).repeat(2));for(let s=1;s<n;s++)for(let u=0;u<s;u++)e[s][u]<1/0&&g.push((y(u)+y(s)).repeat(e[s][u]));if(i&&!i.every(s=>s.every(u=>u===1))&&l>0){if(n===4&&(i[0][1]>1||i[2][3]>1)&&e[0][1]>3&&e[2][3]>3)i[0][1]>1&&g.push("abcdcb".repeat(S(e[0][1],e[1][2],e[0][2],i[0][1]))),i[2][3]>1&&g.push("abcdcb".repeat(S(e[2][3],e[1][2],e[1][3],i[2][3])));else for(let s=1;s<n;s++)for(let u=0;u<s;u++)if(i[u][s]>1){if(u+2<n){const k=S(e[u][s],e[u+1][s+1],e[u][s+1],i[u][s]);g.push((y(u)+y(s)+y(u+2)+y(s)).repeat(k))}if(u-1>=0){const k=S(e[u][s],e[u-1][s-1],e[u-1][s],i[u][s]);g.push((y(u)+y(s)+y(u)+y(u-1)).repeat(k))}}}return g},J=(n,e,i,d,l)=>{const g=z(n,e,i,d,l),s=[...Array(n).keys()].map(k=>y(k)).join(""),u=d.map((k,j)=>k?"":y(B(j))).join("");return{gens:s,subgens:u,rels:g}},K=(n,e,i,d,l)=>{const g=z(n,e,i,d,l),s=[...Array(n).keys()].map(k=>y(k)).join(""),u=[];for(let k=0;k<d.length;k++)if(d[k]){let j=y(k);for(let w=0;w<n;w++)e[k][w]===2&&(d[w]||(j+=y(w)));u.push({gens:s,subgens:j,rels:g,pair:[0,y(k)]})}return u},Q=(n,e,i,d,l)=>{const g=z(n,e,i,d,l),s=[...Array(n).keys()].map(j=>y(j)).join(""),u=[],k=x([...Array(n).keys()]);for(let j=0;j<k.length;j++){const w=k[j],o=e[w[0]][w[1]],A=[];if(d[w[0]]&&d[w[1]]&&isFinite(o))for(let a=0;a<o;a++){const p=w.map(h=>y(h)).join("").repeat(a);A.push(p),A.push(y(w[1])+p)}else if((d[w[0]]||d[w[1]])&&isFinite(o)&&o>2)for(let a=0;a<o;a++){const p=w.map(h=>y(h)).join("").repeat(a);A.push(p)}else continue;let c=y(w[0])+y(w[1]);for(let a=0;a<n;a++)e[w[0]][a]===2&&e[w[1]][a]===2&&(d[a]||(c+=y(a)));u.push({gens:s,subgens:c,rels:g,face:A})}return u},T=(n,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const i=n.normal[e.left_coset][e.rel[e.left]];if(i===void 0)break;e.left++,e.left_coset=i}for(;e.left!==e.right;){const i=n.reverse[e.right_target][e.rel[e.right]];if(i===void 0)break;e.right--,e.right_target=i}return e.left===e.right?(n.normal[e.left_coset][e.rel[e.right]]=e.right_target,n.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},N=n=>{const{gens:e,subgens:i,rels:d,cosets:l,rows:g,words:s,limit:u}=n,k=e.length,j=d.map(c=>[...c].map(a=>e.indexOf(a))),w=i.split("").map(c=>e.indexOf(c));if(l.normal.length===0){l.normal.push(new Array(k).fill()),l.reverse.push(new Array(k).fill());for(let c=0;c<w.length;c++)l.normal[0][w[c]]=0,l.reverse[0][w[c]]=0}for(g.length===0&&g.push(...j.map(c=>({rel:c,left:0,right:c.length-1,left_coset:0,right_target:0})));g.length&&l.normal.length<u;){for(;;){let p=!1;for(let h=g.length-1;h>=0;h--)T(l,g[h])&&(p=!0,g.splice(h,1));if(!p)break}const c=l.normal.length;let a=!1;for(let p=0;p<l.normal.length;p++){const h=l.normal[p];for(let b=0;b<h.length;b++){let f=h[b];if(f===void 0){f=l.normal.length,l.normal.push(new Array(k).fill()),l.reverse.push(new Array(k).fill()),l.normal[p][b]=f,l.reverse[f][b]=p,g.push(...j.map(r=>({rel:r,left:0,right:r.length-1,left_coset:c,right_target:c}))),a=!0;break}}if(a)break}}g.length||(n.done=!0),s.length===0&&(s[0]="");let o=!0,A=l.normal.length;for(;U(l.normal.length,s)&&o&&--A;){o=!1;for(let c=0;c<s.length;c++){if(s[c]===void 0)continue;const a=l.normal[c];for(let p=0;p<a.length;p++){const h=a[p];h===void 0||s[h]!==void 0||(s[h]=s[c]+y(p),o=!0)}}}return o||console.warn("Hole in the cosets"),A===0&&console.warn("Max iterations reached"),{cosets:l,rows:g,words:s}},U=(n,e)=>{for(let i=0;i<n;i++)if(e[i]===void 0)return!0;return!1};let P=null,O=null,W=null,M=null,C=null;const X=(n,e,i,d,l)=>{const g=()=>({cosets:{normal:[],reverse:[]},rows:[],words:[],done:!1,lastDrawn:0});P={...J(n,e,i,d,l),...g()},O=K(n,e,i,d,l).map(s=>({...s,...g()})),W=Q(n,e,i,d,l).map(s=>({...s,...g()})),M=new Map,C=[new Map,new Map]},Y=(n,e)=>{const{rootVertex:i,mirrorsPlanes:d,curvature:l}=n;let g=i;for(let s=0;s<e.length;s++)g=q(g,d[e.charCodeAt(s)-97],l);return g},R=(n,e=0)=>{for(let i=0;i<n.length;i++){const d=G(n[i]),l=P.cosets.normal[e][d];if(l===void 0)return;e=l}return e};onmessage=({data:{order:n,curvature:e,mirrorsPlanes:i,coxeter:d,stellation:l,mirrors:g,rootVertex:s,dimensions:u,uuid:k}})=>{n===0&&X(u,d,l,g,e);const j=(n+1)*(e>0?1e3:250);try{let w=[],o=[],A=[];if(!P.done){P.limit=j,N(P);for(let c=P.lastDrawn;c<P.words.length;c++){const a=P.words[c];if(a===void 0){w.push({vertex:new Array(u).fill(NaN),word:""});continue}const p=Y({rootVertex:s,mirrorsPlanes:i,curvature:e},a);w.push({vertex:p,word:a,i:c}),P.lastDrawn=c+1}}for(let c=0;c<O.length;c++){const a=O[c];if(a.done)continue;a.limit=j,N(a);const p=a.pair[0],h=R(a.pair[1]);for(let b=a.lastDrawn;b<a.words.length;b++){const f=a.words[b];if(f===void 0)continue;const r=R(f,p),t=R(f,h);if(r===void 0||t===void 0){a.lastDrawn=b;break}o.push({start:r,end:t,word:f}),a.lastDrawn=b+1}}for(let c=0;c<W.length;c++){const a=W[c];if(a.done)continue;a.limit=j,N(a);let p=!1;const h=[];for(let b=0;b<a.face.length;b++){const f=a.face[b],r=R(f);if(r===void 0){p=!0;break}h.push(r)}if(p)break;for(let b=a.lastDrawn;b<a.words.length;b++){const f=a.words[b];if(f===void 0)continue;const r=[];for(let t=0;t<h.length;t++){const m=R(f,h[t]);if(m===void 0){p=!0;break}r.push(m)}if(p){a.lastDrawn=b;break}A.push({vertices:r,word:f}),a.lastDrawn=b+1}}if(g.some(c=>c==="s")){const c=g.map((r,t)=>r==="s"?y(t):"").join(""),a=c.length>0?new RegExp(`[^${c}]`,"g"):null;for(let r=0;r<w.length;r++){const t=w[r];t.word.replace(a,"").length%2===1&&(t.vertex=NaN,M.set(t.i,[]))}const p=[],h=new Map;for(let r=0;r<o.length;r++)if(M.has(o[r].start)){h.has(o[r].start)||h.set(o[r].start,[]);const t=M.get(o[r].start);t.push(o[r].end),t.word||(t.word=o[r].word),h.get(o[r].start).push(o[r].end)}else if(M.has(o[r].end)){h.has(o[r].end)||h.set(o[r].end,[]);const t=M.get(o[r].end);t.push(o[r].start),t.word||(t.word=o[r].word),h.get(o[r].end).push(o[r].start)}else p.push(o[r]);const b=Array.from(h.keys());for(let r=0;r<h.size;r++){const t=b[r],m=h.get(t),v=M.get(t);for(let _=0;_<m.length;_++)for(let D=0;D<v.length;D++)m[_]<=v[D]||p.push({start:m[_],end:v[D],word:v.word})}o=p;const f=[];for(let r=0;r<A.length;r++){const t=A[r],m=[];for(let v=0;v<t.vertices.length;v++)M.has(t.vertices[v])||m.push(t.vertices[v]);f.push({...t,vertices:m})}for(let r=0;r<h.size;r++){const t=b[r],m=M.get(t);f.push({vertices:m,word:m.word})}A=f}if(g.some(c=>c==="ß")){const c=g.map((f,r)=>f==="ß"?y(r):"").join(""),a=c.length>0?new RegExp(`[^${c}]`,"g"):null;for(let f=0;f<w.length;f++){const r=w[f];C[r.word.replace(a,"").length%2].set(r.i,[])}const p=[],h=[new Map,new Map];for(let f=0;f<2;f++){for(let t=0;t<o.length;t++)if(C[f].has(o[t].start)){h[f].has(o[t].start)||h[f].set(o[t].start,[]);const m=C[f].get(o[t].start);m.push(o[t].end),m.word||(m.word=o[t].word),h[f].get(o[t].start).push(o[t].end)}else if(C[f].has(o[t].end)){h[f].has(o[t].end)||h[f].set(o[t].end,[]);const m=C[f].get(o[t].end);m.push(o[t].start),m.word||(m.word=o[t].word),h[f].get(o[t].end).push(o[t].start)}else p.push(o[t]);const r=Array.from(h[f].keys());for(let t=0;t<h[f].size;t++){const m=r[t],v=h[f].get(m),_=C[f].get(m);for(let D=0;D<v.length;D++)for(let F=0;F<_.length;F++)v[D]<=_[F]||p.push({start:v[D],end:_[F],word:_.word})}}o=p;const b=[];for(let f=0;f<2;f++){const r=Array.from(h[f].keys());for(let t=0;t<A.length;t++){const m=A[t],v=[];for(let _=0;_<m.vertices.length;_++)C[f].has(m.vertices[_])||v.push(m.vertices[_]);b.push({...m,vertices:v})}for(let t=0;t<h[f].size;t++){const m=r[t],v=C[f].get(m);b.push({vertices:v,word:v.word})}}A=b}postMessage({vertices:w,edges:o,faces:A,order:n,uuid:k})}catch(w){postMessage({error:w.message,uuid:k})}}})();
