(function(){"use strict";const O=(e,t=null,n=1,l=!1)=>{if(t===null&&(t=e,e=0),n===0)throw new Error("Step cannot be zero.");if(t<e&&n>0||t>e&&n<0){if(l)return[];n=-n}return new Array(Math.ceil((t-e)/n)).fill().map((r,f)=>e+f*n)},x=(e,t)=>{let n=0;for(let l=0;l<e.length;l++)n+=e[l]*t[l];return n},z=(e,t)=>{const n=[];for(let l=0;l<e.length;l++)n[l]=e[l]-t[l];return n},v=(e,t)=>{const n=[];for(let l=0;l<e.length;l++)n[l]=e[l]*t;return n},k=e=>{const t=[];for(let n=0;n<e[0].length;n++){t.push([]);for(let l=0;l<e.length;l++)t[n].push(e[l][n])}return t},C=(e,t)=>{const n=new Array(e.length);for(let l=0;l<e.length;l++){let r=0;for(let f=0;f<e[0].length;f++)r+=e[l][f]*t[f];n[l]=r}return n},V=(e,t)=>e.filter((n,l)=>!t.includes(l)),D=(e,t)=>V(e,t).map(n=>V(n,t)),ee=(e,t,n)=>z(e,v(C(le(n),t),2*x(C(ne(n),e),t))),te=(e,t)=>t.some((n,l)=>n.some((r,f)=>l===f&&r===0))?v(e,1/e[e.length-1]):v(e,-1/fe(E(x(C(t,e),e)))),ne=e=>e.map((t,n)=>t.map((l,r)=>n===r&&l===0?1:l)),le=e=>e.map(t=>t.map(n=>E(n))),U=(e,t,n,l)=>{const r=T/e,f=T/t,c=T/n;return F(T/re(-N(r)*N(c)+j(r)*j(c)*((N(f)-N(l*r)*N(c))/(j(l*r)*j(c)))))},{abs:E,cos:N,sin:j,tan:ye,cosh:Ie,sinh:Me,acos:re,acosh:Ne,atan:Se,atan2:Ue,min:je,max:Te,round:F,sqrt:fe,cbrt:Xe,sign:ve,ceil:Ce,floor:Ve,log:He,exp:$e,hypot:Be,pow:Pe,PI:T}=Math,G=new ArrayBuffer(8),ce=new Float64Array(G),R=new Int32Array(G);function se(e){return~~e===e?~~e:(ce[0]=e,R[0]^R[1])}const q=10**4,oe=e=>{let t="";for(let n=0;n<e.length;n++)t+=se(F(e[n]*q)/q).toString(),n<e.length-1&&(t+="|");return t};function*ie(e,t){if(t<0||e.length<t)return;const n=Array.from(Array(t).keys());for(;;){yield n.map(r=>e[r]);let l=t-1;for(;l>=0&&n[l]>=e.length-t+l;)l--;if(l<0)return;for(let r=n[l]+1;l<t;l++,r++)n[l]=r}}const L=(e,t=2)=>Array.from(ie(e,t)),p=e=>String.fromCharCode(97+e),W=(e,t,n,l=[])=>{const r=[];for(let f=0;f<e;f++)l.includes(f)||r.push(p(f).repeat(2));for(let f=1;f<e;f++)for(let c=0;c<f;c++)!l.includes(f)&&!l.includes(c)&&t[f][c]>1&&r.push((p(c)+p(f)).repeat(t[f][c]));if(!l.length&&n&&!n.every(f=>f.every(c=>c===1))){if(e===4&&n[0][1]>1!=n[2][3]>1&&t[0][1]>3&&t[2][3]>3)n[0][1]>1&&r.push("abcdcb".repeat(U(t[0][1],t[1][2],t[0][2],n[0][1]))),n[2][3]>1&&r.push("abcdcb".repeat(U(t[2][3],t[1][2],t[1][3],n[2][3])));else for(let f=1;f<e;f++)for(let c=0;c<f;c++)if(n[c][f]>1){if(c+2<e){const s=U(t[c+1][f+1],t[c][f],t[c][f+1],n[c][f]);r.push((p(c)+p(f)+p(c+2)+p(f)).repeat(s))}if(c-1>=0){const s=U(t[c-1][f-1],t[c][f],t[c-1][f],n[c][f]);r.push((p(c)+p(f)+p(c)+p(c-1)).repeat(s))}}}return r},ae=e=>e!==""&&e!=="x",J=(e,t=[])=>e.map((n,l)=>t.includes(l)?"":p(l)).join(""),K=(e,t=[])=>e.map((n,l)=>t.includes(l)||n?"":p(l)).join(""),he=(e,t)=>{if(t===0)return!0;const n=new Set;for(let l=0;l<e.length;l++){const r=e[l];if(!(!r||n.has(r))&&(n.add(r),n.size===t))return!0}return!1},H=(e,t,n,l,r=null,f=null,c=new Map)=>{r=r||l.map((s,o)=>ae(s)?null:o).filter(s=>s!==null),f=f||{new:!0,dimensions:e,gens:J(l,r),subgens:K(l,r),rels:W(e,t,n,r),[`${e}-face`]:[""],coxeter:t,stellation:n,mirrors:l,skips:r,children:[]};for(let s=0;s<e;s++){if(r.includes(s))continue;const o=[...r,s],i=O(e).filter(d=>!o.includes(d)),a=o.sort().join("-");let u=!1;c.has(a)||(u=!0,c.set(a,ue(e,t,n,l,o)));const g=c.get(a);if(he(g[g.length-1],e-o.length)){let d="";for(let h=0;h<e;h++)(!o.includes(h)||!l[h]&&!i.some(_=>t[_][h]!==2))&&(d+=p(h));let b={new:u,dimensions:e-o.length,subgens:d,[`${e-o.length}-face`]:g,coxeter:D(t,o),stellation:D(n,o),mirrors:V(l,o),skips:o,double:l.filter((h,_)=>!o.includes(_)).every(h=>!!h),children:[]};e-o.length>0&&(b=H(e,t,n,l,o,b,c)),f.children.push(b)}}if(f.children.length===0){console.info("No leaf found, digging deeper",r);for(let s=0;s<e;s++){if(r.includes(s))continue;const o=[...r,s];f.children.push(H(e,t,n,l,o,{children:[]},c))}}return f},ge=(e,t)=>{if(t.left===t.right)return!1;for(;t.left!==t.right;){const n=e.normal[t.left_coset][t.rel[t.left]];if(n===4294967295)break;t.left++,t.left_coset=n}for(;t.left!==t.right;){const n=e.reverse[t.right_target][t.rel[t.right]];if(n===4294967295)break;t.right--,t.right_target=n}return t.left===t.right?(e.normal[t.left_coset][t.rel[t.right]]=t.right_target,e.reverse[t.right_target][t.rel[t.right]]=t.left_coset,!0):!1},ue=(e,t,n,l,r)=>{const f=W(e,t,n,r),c=J(l,r),s=K(l,r);return Y({gens:c,subgens:s,rels:f}).words};function Q(e){e.cosets||(e.cosets={normal:[],reverse:[]}),e.rows||(e.rows=[]),e.limit||(e.limit=1e3),e.done||(e.done=!1);const{gens:t,subgens:n,rels:l,cosets:r,rows:f,limit:c}=e,s=t.length,o=l.map(a=>[...a].map(u=>t.indexOf(u))),i=n.split("").map(a=>t.indexOf(a));if(r.normal.length===0){r.normal.push(new Uint32Array(s).fill(4294967295)),r.reverse.push(new Uint32Array(s).fill(4294967295));for(let a=0;a<i.length;a++)r.normal[0][i[a]]=0,r.reverse[0][i[a]]=0}for(f.length===0&&f.push(...o.map(a=>({rel:a,left:0,right:a.length-1,left_coset:0,right_target:0})));f.length&&r.normal.length<c;){for(;;){let g=!1;for(let d=f.length-1;d>=0;d--)ge(r,f[d])&&(g=!0,f[d]=f[f.length-1],f.pop());if(!g)break}const a=r.normal.length;let u=!1;for(let g=0;g<r.normal.length;g++){const d=r.normal[g];for(let b=0;b<d.length;b++){let h=d[b];if(h===4294967295){h=r.normal.length,r.normal.push(new Uint32Array(s).fill(4294967295)),r.reverse.push(new Uint32Array(s).fill(4294967295)),r.normal[g][b]=h,r.reverse[h][b]=g,f.push(...o.map(_=>({rel:_,left:0,right:_.length-1,left_coset:a,right_target:a}))),u=!0;break}}if(u)break}}e.done=!f.length}const de=(e,t)=>{for(let n=0;n<e;n++)if(t[n]===void 0)return!0;return!1};function be(e){e.words||(e.words=[]);const{gens:t,cosets:{normal:n},words:l}=e;l.length===0&&(l[0]="");let r=!0,f=n.length;for(;de(n.length,l)&&r&&--f;){r=!1;for(let c=0;c<l.length;c++){if(l[c]===void 0)continue;const s=n[c];for(let o=0;o<s.length;o++){const i=s[o];i===4294967295||l[i]!==void 0||(l[i]=l[c]+t[o],r=!0)}}}r||console.warn("Hole in the cosets"),f===0&&console.warn("Max iterations reached")}const Y=e=>(Q(e),be(e),e),pe=(e,t,n,l=1e3)=>{const r={gens:e,subgens:t,rels:n,limit:l};return Q(r),r.done?r.cosets.normal.length:NaN};typeof window<"u"&&(window.bench=()=>{const e=performance.now(),t=pe("abcdefgh","abdefgh",["aa","bb","cc","dd","ee","ff","gg","hh","ababab","acac","bcbcbc","adad","bdbd","cdcdcd","aeae","bebe","cecece","dede","afaf","bfbf","cfcf","dfdf","efefef","agag","bgbg","cgcg","dgdg","egeg","fgfgfg","ahah","bhbh","chch","dhdh","eheh","fhfh","ghghgh"],5e3);console.info(t,performance.now()-e)});let m=null,S=null,X=null,$=null,B=null,P=0;const _e=(e,t,n,l,r)=>{const f=()=>({lastDrawn:0}),c=k(l);S=O(e).map(i=>te(c[i],r)),m=null;const s=H(e,t,n,new Array(e).fill(1)),o=i=>{i.new&&i["0-face"]&&(m={gens:s.gens,rels:s.rels,subgens:i.subgens,vertex:i["0-face"],...f()}),i.children&&i.children.forEach(o)};o(s),X=new Map,$=new Set,B=new Set,P=0},Ae=(e,t)=>{const{rootVertex:n,rootNormals:l,metric:r}=e;let f=n;for(let c=0;c<t.length;c++)f=ee(f,l[t.charCodeAt(c)-97],r);return f};onmessage=({data:{order:e,metric:t,rootNormals:n,coxeter:l,stellation:r,rootVertices:f,dimensions:c,uuid:s}})=>{e===0&&_e(c,l,r,f,t);const o=e===0?1:(e+1)*100,i=L(new Array(S.length).fill().map((u,g)=>g)),a=L(new Array(S.length).fill().map((u,g)=>g),3);try{let u=[],g=[],d=[];if(!m.done){m.limit=o,Y(m);for(let b=m.lastDrawn;b<m.words.length;b++){const h=m.words[b];if(h===void 0)continue;const _=[];for(let A=0;A<S.length;A++){const I=S[A],y=Ae({rootVertex:I,rootNormals:n,metric:t},h),w=oe(y);if(X.has(w))_.push(X.get(w));else{u.push({vertex:y,word:h,i:b});const M=P+u.length-1;X.set(w,M),_.push(M)}}m.lastDrawn=b+1;for(let A=0;A<i.length;A++){const[I,y]=i[A],[w,M]=[_[I],_[y]],Z=I<y?`${w}-${M}`:`${M}-${w}`;$.has(Z)||(g.push({start:w,end:M,word:h}),$.add(Z))}for(let A=0;A<a.length;A++){const I=a[A].map(w=>_[w]),y=I.sort().join("-");B.has(y)||(d.push({vertices:I,word:h}),B.add(y))}}}P+=u.length,postMessage({vertices:u,edges:g,faces:d,order:e,uuid:s})}catch(u){postMessage({error:u.message,uuid:s})}}})();
