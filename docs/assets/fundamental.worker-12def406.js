(function(){"use strict";const q=(t,e=null,n=1,r=!1)=>{if(e===null&&(e=t,t=0),n===0)throw new Error("Step cannot be zero.");if(e<t&&n>0||e>t&&n<0){if(r)return[];n=-n}return new Array(Math.ceil((e-t)/n)).fill().map((s,l)=>t+l*n)},D=(t,e)=>{let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[r];return n},L=(t,e)=>{const n=[];for(let r=0;r<t.length;r++)n[r]=t[r]-e[r];return n},M=(t,e)=>{const n=[];for(let r=0;r<t.length;r++)n[r]=t[r]*e;return n},U=t=>{const e=[];for(let n=0;n<t[0].length;n++){e.push([]);for(let r=0;r<t.length;r++)e[n].push(t[r][n])}return e},P=(t,e)=>{const n=new Array(t.length);for(let r=0;r<t.length;r++){let s=0;for(let l=0;l<t[0].length;l++)s+=t[r][l]*e[l];n[r]=s}return n},W=(t,e,n)=>L(t,M(P(Q(n),e),2*D(P(K(n),t),e))),J=(t,e)=>e.some((n,r)=>n.some((s,l)=>r===l&&s===0))?M(t,1/t[t.length-1]):M(t,-1/Y(O(D(P(e,t),t)))),K=t=>t.map((e,n)=>e.map((r,s)=>n===s&&r===0?1:r)),Q=t=>t.map(e=>e.map(n=>O(n))),k=(t,e,n,r)=>{const s=C/t,l=C/e,o=C/n;return E(C/X(-V(s)*V(o)+v(s)*v(o)*((V(l)-V(r*s)*V(o))/(v(r*s)*v(o)))))},{abs:O,cos:V,sin:v,tan:ge,cosh:de,sinh:me,acos:X,acosh:pe,atan:be,atan2:ye,min:Ae,max:_e,round:E,sqrt:Y,sign:we,ceil:je,floor:Se,log:Ve,exp:Ie,hypot:ke,pow:ve,PI:C}=Math,F=new ArrayBuffer(8),Z=new Float64Array(F),G=new Int32Array(F);function z(t){return~~t===t?~~t:(Z[0]=t,G[0]^G[1])}const N=10**4,ee=t=>{let e="";for(let n=0;n<t.length;n++)e+=z(E(t[n]*N)/N).toString(),n<t.length-1&&(e+="|");return e};function*te(t,e){if(e<0||t.length<e)return;const n=Array.from(Array(e).keys());for(;;){yield n.map(s=>t[s]);let r=e-1;for(;r>=0&&n[r]>=t.length-e+r;)r--;if(r<0)return;for(let s=n[r]+1;r<e;r++,s++)n[r]=s}}const R=(t,e=2)=>Array.from(te(t,e)),h=t=>String.fromCharCode(97+t),ne=(t,e,n,r=[])=>{const s=[];for(let l=0;l<t;l++)r.includes(l)||s.push(h(l).repeat(2));for(let l=1;l<t;l++)for(let o=0;o<l;o++)!r.includes(l)&&!r.includes(o)&&e[l][o]>1&&s.push((h(o)+h(l)).repeat(e[l][o]));if(!r.length&&n&&!n.every(l=>l.every(o=>o===1))){if(t===4&&n[0][1]>1!=n[2][3]>1&&e[0][1]>3&&e[2][3]>3)n[0][1]>1&&s.push("abcdcb".repeat(k(e[0][1],e[1][2],e[0][2],n[0][1]))),n[2][3]>1&&s.push("abcdcb".repeat(k(e[2][3],e[1][2],e[1][3],n[2][3])));else for(let l=1;l<t;l++)for(let o=0;o<l;o++)if(n[o][l]>1){if(o+2<t){const u=k(e[o+1][l+1],e[o][l],e[o][l+1],n[o][l]);s.push((h(o)+h(l)+h(o+2)+h(l)).repeat(u))}if(o-1>=0){const u=k(e[o-1][l-1],e[o][l],e[o-1][l],n[o][l]);s.push((h(o)+h(l)+h(o)+h(o-1)).repeat(u))}}}return s},re=t=>t!==""&&t!=="x",le=(t,e=[])=>t.map((n,r)=>e.includes(r)?"":h(r)).join(""),se=(t,e=[])=>t.map((n,r)=>e.includes(r)||n?"":h(r)).join(""),oe=(t,e,n,r)=>{const s=r.map((b,w)=>re(b)?null:w).filter(b=>b),l=ne(t,e,n,s),o=le(r,s),u=se(r,s);return{gens:o,subgens:u,rels:l}},ae=(t,e)=>{if(e.left===e.right)return!1;for(;e.left!==e.right;){const n=t.normal[e.left_coset][e.rel[e.left]];if(n===void 0)break;e.left++,e.left_coset=n}for(;e.left!==e.right;){const n=t.reverse[e.right_target][e.rel[e.right]];if(n===void 0)break;e.right--,e.right_target=n}return e.left===e.right?(t.normal[e.left_coset][e.rel[e.right]]=e.right_target,t.reverse[e.right_target][e.rel[e.right]]=e.left_coset,!0):!1},ie=t=>{const{gens:e,subgens:n,rels:r,cosets:s,rows:l,words:o,limit:u}=t,b=e.length,w=r.map(a=>[...a].map(d=>e.indexOf(d))),j=n.split("").map(a=>e.indexOf(a));if(s.normal.length===0){s.normal.push(new Array(b).fill()),s.reverse.push(new Array(b).fill());for(let a=0;a<j.length;a++)s.normal[0][j[a]]=0,s.reverse[0][j[a]]=0}for(l.length===0&&l.push(...w.map(a=>({rel:a,left:0,right:a.length-1,left_coset:0,right_target:0})));l.length&&s.normal.length<u;){for(;;){let i=!1;for(let f=l.length-1;f>=0;f--)ae(s,l[f])&&(i=!0,l.splice(f,1));if(!i)break}const a=s.normal.length;let d=!1;for(let i=0;i<s.normal.length;i++){const f=s.normal[i];for(let c=0;c<f.length;c++){let m=f[c];if(m===void 0){m=s.normal.length,s.normal.push(new Array(b).fill()),s.reverse.push(new Array(b).fill()),s.normal[i][c]=m,s.reverse[m][c]=i,l.push(...w.map(p=>({rel:p,left:0,right:p.length-1,left_coset:a,right_target:a}))),d=!0;break}}if(d)break}}l.length||(t.done=!0),o.length===0&&(o[0]="");let g=!0,y=s.normal.length;for(;fe(s.normal.length,o)&&g&&--y;){g=!1;for(let a=0;a<o.length;a++){if(o[a]===void 0)continue;const d=s.normal[a];for(let i=0;i<d.length;i++){const f=d[i];f===void 0||o[f]!==void 0||(o[f]=o[a]+e[i],g=!0)}}}return g||console.warn("Hole in the cosets"),y===0&&console.warn("Max iterations reached"),{cosets:s,rows:l,words:o}},fe=(t,e)=>{for(let n=0;n<t;n++)if(e[n]===void 0)return!0;return!1};let _=null,I=null,H=null,x=null,B=null,$=0;const ce=(t,e,n,r,s)=>{const l=()=>({cosets:{normal:[],reverse:[]},rows:[],words:[],done:!1,lastDrawn:0}),o=U(r);I=q(t).map(u=>J(o[u],s)),_={...oe(t,e,n,new Array(t).fill(1)),...l()},H=new Map,x=new Set,B=new Set,$=0},he=(t,e)=>{const{rootVertex:n,rootNormals:r,metric:s}=t;let l=n;for(let o=0;o<e.length;o++)l=W(l,r[e.charCodeAt(o)-97],s);return l};onmessage=({data:{order:t,metric:e,rootNormals:n,coxeter:r,stellation:s,rootVertices:l,dimensions:o,uuid:u}})=>{t===0&&ce(o,r,s,l,e);const b=t===0?1:(t+1)*10,w=R(new Array(I.length).fill().map((g,y)=>y)),j=R(new Array(I.length).fill().map((g,y)=>y),3);try{let g=[],y=[],a=[];if(!_.done){_.limit=b,ie(_);for(let d=_.lastDrawn;d<_.words.length;d++){const i=_.words[d];if(i===void 0)continue;const f=[];for(let c=0;c<I.length;c++){const m=I[c],p=he({rootVertex:m,rootNormals:n,metric:e},i),A=ee(p);if(H.has(A))f.push(H.get(A));else{g.push({vertex:p,word:i,i:d});const S=$+g.length-1;H.set(A,S),f.push(S)}}_.lastDrawn=d+1;for(let c=0;c<w.length;c++){const[m,p]=w[c],[A,S]=[f[m],f[p]],T=m<p?`${A}-${S}`:`${S}-${A}`;x.has(T)||(y.push({start:A,end:S,word:i}),x.add(T))}for(let c=0;c<j.length;c++){const m=j[c].map(A=>f[A]),p=m.sort().join("-");B.has(p)||(a.push({vertices:m,word:i}),B.add(p))}}}$+=g.length,postMessage({vertices:g,edges:y,faces:a,order:t,uuid:u})}catch(g){postMessage({error:g.message,uuid:u})}}})();
